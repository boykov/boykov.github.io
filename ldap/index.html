<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="ru" xml:lang="ru">
<head>
<!-- 2016-11-24 Чт. 17:23 -->
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="viewport" content="width=device-width, initial-scale=1" />
<title>Аутентификация пользователей CentOS 5/6 с использованием OpenLDAP 2.3/2.4</title>
<meta  name="generator" content="Org-mode" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  pre.src-sh:before    { content: 'sh'; }
  pre.src-bash:before  { content: 'sh'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-R:before     { content: 'R'; }
  pre.src-perl:before  { content: 'Perl'; }
  pre.src-java:before  { content: 'Java'; }
  pre.src-sql:before   { content: 'SQL'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="../org-html-themes/styles/readtheorg/css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="../org-html-themes/styles/readtheorg/css/readtheorg.css"/>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script type="text/javascript" src="../org-html-themes/styles/lib/js/jquery.stickytableheaders.min.js"></script>
<script type="text/javascript" src="../org-html-themes/styles/readtheorg/js/readtheorg.js"></script>
<style type="text/css">.org-src-name{ text-align: right; }</style>
<style type="text/css">.outline-2{ margin-top: 60px; }</style>

<style type="text/css">
  pre.src:before {
    top: -5px;
  }
</style>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">Аутентификация пользователей CentOS 5/6 с использованием OpenLDAP 2.3/2.4</h1>
<div id="table-of-contents">
<h2>&#1057;&#1086;&#1076;&#1077;&#1088;&#1078;&#1072;&#1085;&#1080;&#1077;</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#intro">Введение</a></li>
<li><a href="#install-and-config">1. Установка и настройка сервера OpenLDAP</a>
<ul>
<li><a href="#install-openldap">1.1. Установка OpenLDAP</a></li>
<li><a href="#configure-hdb">1.2. Добавление файлов конфигурации базы данных HDB</a></li>
<li><a href="#add-schemas">1.3. Добавление файлов схем</a></li>
<li><a href="#choose-setup">1.4. Выбор варианта настройки схемы БД LDAP</a></li>
<li><a href="#configure-slapd-conf">1.5. Предварительная настройка схемы БД LDAP</a></li>
<li><a href="#configure-slapd">1.6. Дополнительно. Предварительная настройка схемы БД LDAP с помощью ldif формата</a></li>
</ul>
</li>
<li><a href="#authentification">2. Настройка аутентификации пользователей при помощи LDAP&nbsp;<sup><i class="fa fa-star-half-o"></i></sup></a>
<ul>
<li><a href="#client-packages">2.1. Требуемые пакеты</a></li>
<li><a href="#client-commands">2.2. Используемые команды&nbsp;<sup><i class="fa fa-star"></i></sup></a></li>
<li><a href="#client-files">2.3. Изменяемые файлы&nbsp;<sup><i class="fa fa-star"></i></sup></a></li>
<li><a href="#client-options">2.4. Описание опций&nbsp;<sup><i class="fa fa-star"></i></sup></a>
<ul>
<li><a href="#orgheadline12">2.4.1. PAM: необходимые сведения</a></li>
<li><a href="#orgheadline13">2.4.2. Опции, связанные с conf-файлами для <b>5/2.3</b></a></li>
<li><a href="#orgheadline14">2.4.3. Опции, связанные с system-auth для <b>5/2.3</b></a></li>
<li><a href="#orgheadline15">2.4.4. Опции, связанные с conf-файлами для <b>6/2.4</b></a></li>
<li><a href="#orgheadline16">2.4.5. Опции, связанные с system-auth для <b>6/2.4</b></a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#schema">3. Схема БД LDAP</a>
<ul>
<li><a href="#ldap-possibilities">3.1. Возможности LDAP</a></li>
<li><a href="#minimal-schema">3.2. Подготовка к тестированию аутентификации при помощи LDAP</a></li>
</ul>
</li>
<li><a href="#new-user">4. Процесс добавления нового пользователя в систему</a>
<ul>
<li><a href="#new-user-ldap">4.1. Добавление пользователя с помощью CLI интерфейса</a></li>
<li><a href="#new-user-php">4.2. Добавление пользователя с помощью GUI Web интерфейса</a></li>
<li><a href="#test-client">4.3. Тестирование клиентского подключения</a></li>
<li><a href="#standard-commands">4.4. Стандартные команды администрирования пользователей в случае использования LDAP</a></li>
<li><a href="#add-users">4.5. Миграция пользователей и групп</a></li>
</ul>
</li>
<li><a href="#cluster">5. Перевести аутентификацию пользователей кластера на использование LDAP</a></li>
</ul>
</div>
</div>

<div id="outline-container-orgheadline1" class="outline-2">
<h2 id="intro"><a id="orgheadline1"></a><a id="ID-be7bb1b4-d8e8-4b5f-8aa3-754d148fa6ba"></a>Введение</h2>
<div class="outline-text-2" id="text-intro">
<p>
В процессе написания использовались материалы
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">English version</th>
<th scope="col" class="org-left">Русская версия</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><a href="http://www.openldap.org/doc/admin24/">OpenLDAP Software 2.4 Administrator's Guide</a></td>
<td class="org-left"><a href="http://pro-ldap.ru/tr/admin24/index.html">Руководство администратора OpenLDAP 2.4</a></td>
</tr>

<tr>
<td class="org-left"><a href="http://www.openldap.org/doc/admin23/">OpenLDAP Software 2.3 Administrator's Guide</a></td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="http://www.zytrax.com/books/ldap/">LDAP for Rocket Scientists</a></td>
<td class="org-left"><a href="http://pro-ldap.ru/tr/zytrax/">LDAP для ученых-ракетчиков</a></td>
</tr>

<tr>
<td class="org-left"><a href="http://itdavid.blogspot.ru/2012/05/howto-centos-6.html">HOWTO : CentOS 6.2 OpenLDAP 2.4 Setup </a></td>
<td class="org-left"><a href="http://pro-ldap.ru/books/openldap-ubuntu-in-practice/">OpenLDAP и Ubuntu на практике</a></td>
</tr>

<tr>
<td class="org-left"><a href="https://www.packtpub.com/networking-and-servers/mastering-openldap-configuring-securing-and-integrating-directory-services">Matt Butcher. <b>Mastering OpenLDAP: Configuring, Securing and Integrating Directory Services</b>. Packt Publishing, 2007.</a></td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><a href="http://www.linux-pam.org/Linux-PAM-html/Linux-PAM_SAG.html">The Linux-PAM System Administrators' Guide</a></td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>

<p>
Конфигурация используемых на нашем демо-стенде контейнеров:
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Роль</th>
<th scope="col" class="org-left">Имя контейнера</th>
<th scope="col" class="org-left">ОС</th>
<th scope="col" class="org-left">Способ конфигурации <b>OpenLDAP</b></th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><b>Сервер каталогов</b></td>
<td class="org-left">server-ldif5</td>
<td class="org-left"><b>Centos 5</b></td>
<td class="org-left"><b>OpenLDAP 2.3</b> server, <b>ldif</b></td>
</tr>

<tr>
<td class="org-left"><b>Сервер каталогов</b></td>
<td class="org-left">server-ldif6</td>
<td class="org-left"><b>Centos 6</b></td>
<td class="org-left"><b>OpenLDAP 2.4</b> server, <b>ldif</b></td>
</tr>

<tr>
<td class="org-left"><b>Сервер каталогов</b></td>
<td class="org-left">server-conf5</td>
<td class="org-left"><b>Centos 5</b></td>
<td class="org-left"><b>OpenLDAP 2.3</b> server, <b>conf</b></td>
</tr>

<tr>
<td class="org-left"><b>Сервер каталогов</b></td>
<td class="org-left">server-conf6</td>
<td class="org-left"><b>Centos 6</b></td>
<td class="org-left"><b>OpenLDAP 2.4</b> server, <b>conf</b></td>
</tr>

<tr>
<td class="org-left"><b>Клиентский хост</b></td>
<td class="org-left">client5</td>
<td class="org-left"><b>Centos 5</b></td>
<td class="org-left"><b>OpenLDAP 2.3</b> client</td>
</tr>

<tr>
<td class="org-left"><b>Клиентский хост</b></td>
<td class="org-left">client6</td>
<td class="org-left"><b>Centos 6</b></td>
<td class="org-left"><b>OpenLDAP 2.4</b> client</td>
</tr>
</tbody>
</table>

<div class="note">
<p>
Команды и конфигурационные файлы прошли проверку на работоспособность в тестовом программном окружении, доступном в проекте <a href="https://github.com/boykov/cc-ldap-centos">cc-ldap-centos</a>.
</p>

</div>
</div>
</div>

<div id="outline-container-orgheadline8" class="outline-2">
<h2 id="install-and-config"><a id="orgheadline8"></a><a id="ID-f3a148ae-26f4-4c54-a25c-532d2b9086ba"></a><span class="section-number-2">1</span> Установка и настройка сервера OpenLDAP</h2>
<div class="outline-text-2" id="text-install-and-config">
<blockquote>
<p>
Необходимо разработать документацию по установке и настройке сервера LDAP в ОС <b>CentOS 5</b>. Предпочтение отдавать реализациям, доступным в базовом репозитории дистрибутива. Проверить работоспособность выработанных инструкций в ОС <b>CentOS 6</b>.
</p>
</blockquote>
</div>

<div id="outline-container-orgheadline2" class="outline-3">
<h3 id="install-openldap"><a id="orgheadline2"></a><a id="ID-cdb77a09-a1eb-4db8-ad05-e45c3b49418c"></a><span class="section-number-3">1.1</span> Установка OpenLDAP</h3>
<div class="outline-text-3" id="text-install-openldap">
<p>
Базовые репозитории дистрибутивов <b>CentOS 5</b> и <b>CentOS 6</b> содержат <b>2.3</b> и <b>2.4</b> версию <b>OpenLDAP</b>, соответственно. Выполнив стандартную установку
</p>

<div class="org-src-container">
<label class="org-src-name">Установка сервера <b>OpenLDAP</b> для <b>5/2.3</b> и <b>6/2.4</b></label>
<pre class="src src-sh">yum -y install openldap openldap-servers openldap-clients sudo
</pre>
</div>
<p>
получаем две конфигурации, различающиеся в некоторых деталях. Например, название сервиса: <b>ldap</b> в случае <b>CentOS 5/2.3 OpenLDAP</b> (<b>5/2.3</b>) и <b>slapd</b> в случае <b>CentOS 6/2.4 OpenLDAP</b> (<b>6/2.4</b>).
</p>
</div>
</div>

<div id="outline-container-orgheadline3" class="outline-3">
<h3 id="configure-hdb"><a id="orgheadline3"></a><a id="ID-af4bb15a-67f0-4e1a-8ce6-18c118ff10cd"></a><span class="section-number-3">1.2</span> Добавление файлов конфигурации базы данных HDB</h3>
<div class="outline-text-3" id="text-configure-hdb">
<p>
Для запуска сервиса <b>ldap</b> (<b>slapd</b>) необходимо подготовить каталог и файл конфигурации базы данных. Расположение образца файла настройки, в <b>5/2.3</b>
</p>
<div class="org-src-container">
<label class="org-src-name">Конфигурация БД для <b>5/2.3</b></label>
<pre class="src src-sh">    cp /etc/openldap/DB_CONFIG.example /var/lib/ldap/DB_CONFIG
    chown ldap. /var/lib/ldap/DB_CONFIG
</pre>
</div>
<p>
а в <b>6/2.4</b>
</p>
<div class="org-src-container">
<label class="org-src-name">Конфигурация БД для <b>6/2.4</b></label>
<pre class="src src-sh">    cp /usr/share/openldap-servers/DB_CONFIG.example /var/lib/ldap/DB_CONFIG
    chown ldap. /var/lib/ldap/DB_CONFIG
</pre>
</div>
<p>
Используем настройки без изменений в обеих конфигурациях.
</p>
</div>
</div>
<div id="outline-container-orgheadline4" class="outline-3">
<h3 id="add-schemas"><a id="orgheadline4"></a><a id="ID-6638ce89-fc58-4610-aa0a-ab3ade7d3825"></a><span class="section-number-3">1.3</span> Добавление файлов схем</h3>
<div class="outline-text-3" id="text-add-schemas">
<p>
Общая схема БД LDAP, в том числе, содержит раздел <b>cn=schema</b>, куда
подключаются дополнительные специфические схемы.  Подготовим
необходимые файлы (не включенные в поставку <b>OpenLDAP</b>), для <b>5/2.3</b>
</p>
<div class="org-src-container">
<label class="org-src-name">Добавление файлов схем для <b>5/2.3</b></label>
<pre class="src src-sh">    cp /usr/share/doc/sudo-1.7.2p1/schema.OpenLDAP /etc/openldap/schema/sudo.schema
    chown ldap. /etc/openldap/schema/sudo.schema
</pre>
</div>
<p>
и для <b>6/2.4</b>
</p>
<div class="org-src-container">
<label class="org-src-name">Добавление файлов схем для <b>6/2.4</b></label>
<pre class="src src-sh">    cp /usr/share/doc/sudo-1.8.6p3/schema.OpenLDAP /etc/openldap/schema/sudo.schema
    chown ldap. /etc/openldap/schema/sudo.schema
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline5" class="outline-3">
<h3 id="choose-setup"><a id="orgheadline5"></a><a id="ID-cb0ed9d0-14cc-4969-897d-a398e2f1ea65"></a><span class="section-number-3">1.4</span> Выбор варианта настройки схемы БД LDAP</h3>
<div class="outline-text-3" id="text-choose-setup">
<p>
Конфигурация <b>6/2.4</b> поставляется с тремя вариантами базовых настроек,
осуществляемых через файлы <b>slapd.conf.obsolete</b>, <b>slapd.ldif.example</b>
и, доступным по умолчанию, предварительно сформированным каталогом
<b>slapd.d</b>. При этом, настройка с помощью <b>slapd.ldif.example</b>
подразумевает использование утилиты <b>slapadd</b>, как это рекомендуется в
разделе руководства "быстрый
старт"<sup><a id="fnr.1" class="footref" href="#fn.1">1</a></sup>. Конфигурация
<b>5/2.3</b> по умолчанию настраивается только файлом <b>slapd.conf</b>,
предварительно сформированный каталог <b>slapd.d</b> в формате <b>ldif</b>
отсутствует. Такой подход считается устаревшим,
рекомендуется<sup><a id="fnr.2" class="footref" href="#fn.2">2</a></sup>
использовать <b>ldif</b> формат и преобразовывать <b>slapd.conf</b> файл
настройки в каталог <b>slapd.d</b> с помощью утилиты <b>slaptest</b>.
</p>

<p>
Все варианты настроек разделяются на два существенно отличающихся
способа. Первый включает в себя настройку через <b>conf</b> файлы (
конвертация через <b>slaptest</b>) и предварительно сформированный каталог
<b>slapd.d</b> (только для версии <b>2.4</b>). Эти варианты являются
взаимозаменяемыми и формируют практически идентичные результирующие
файлы каталога <b>slapd.d</b>. Второй способ заключается в использовании
файла <b>slapd.ldif</b> и утилиты <b>slapdd</b>. В этом случае, содержимое
файлов каталога <b>slapd.d</b> существенно отличается, по сравнению с
первым способом. Дело в том, что при использовании первого способа в
файлах каталога <b>slapd.d</b> присутствует большое количество
дополнительных параметров (явно не указанных в файле <b>slapd.conf</b>), а
при использовании второго &#x2014; только те, которые явно прописываются в
файле <b>slapd.ldif</b>. Хотя, здесь обнаружилось и небольшое исключение для записи <b>frontend</b>.
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption class="t-above"><span class="table-number">&#1058;&#1072;&#1073;&#1083;&#1080;&#1094;&#1072; 1.:</span> Поддержка способов настройки схемы БД LDAP различными версиями <b>OpenLDAP</b></caption>

<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Способы настройки</th>
<th scope="col" class="org-left">поддержка <b>ldif</b></th>
<th scope="col" class="org-left"><b>2.3</b></th>
<th scope="col" class="org-left"><b>2.4</b></th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Настройка с помощью файла <b>slapd.conf</b></td>
<td class="org-left">конвертация <b>slaptest</b></td>
<td class="org-left">да</td>
<td class="org-left">да</td>
</tr>

<tr>
<td class="org-left">Настройка с помощью файла <b>slapd.ldif</b></td>
<td class="org-left">да</td>
<td class="org-left">особо</td>
<td class="org-left">особо</td>
</tr>

<tr>
<td class="org-left">Предварительно сформированный каталог <b>slapd.d</b></td>
<td class="org-left">да</td>
<td class="org-left">нет</td>
<td class="org-left">да</td>
</tr>
</tbody>
</table>

<p>
Какой вариант настройки выбрать? Если требуется наличие тех
дополнительных параметров, которые разработчики посчитали нужным
включить в настройки по умолчанию, то выбирается первый способ
настройки &#x2014; основной. При этом, если выбирается <b>2.3</b> версия
<b>OpenLDAP</b>, то используются <b>slapd.conf</b> файл и утилита <b>slaptest</b>. А
если <b>2.4</b> версия, то можно в качестве равноценной альтернативы воспользоваться
предварительно сформированным каталогом <b>slapd.d</b>.
</p>

<p>
Если же потребуется тщательно настраивать конфигурацию с нуля,
полностью контролируя все параметры, которые будут задействованы, то
нужно воспользоваться вторым способом &#x2014; дополнительным.
</p>
</div>
</div>

<div id="outline-container-orgheadline6" class="outline-3">
<h3 id="configure-slapd-conf"><a id="orgheadline6"></a><a id="ID-fd3e3e26-d416-4cc5-9dfa-554caeaf7830"></a><span class="section-number-3">1.5</span> Предварительная настройка схемы БД LDAP</h3>
<div class="outline-text-3" id="text-configure-slapd-conf">
<p>
Продемонстрируем первый способ настройки. Внесем небольшие изменения в
конфигурационный файл для <b>5/2.3</b>
</p>

<div align="right">
<a onclick="toggleDiv2('myContent',$(this));" class="fa fa-caret-right">/root/slapd.conf</a>
</div>
<div id="myContent" style="display:none">
<div class="org-src-container">
<label class="org-src-name">Конфигурационный файл для <b>5/2.3</b></label>
<pre class="src src-conf-space"><span style="color: #93a1a1;">#</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">See slapd.conf(5) for details on configuration options.</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">This file should NOT be world readable.</span>
<span style="color: #93a1a1;">#</span>
<span style="color: #268bd2;">include</span>         /etc/openldap/schema/core.schema
<span style="color: #268bd2;">include</span>         /etc/openldap/schema/cosine.schema
<span style="color: #268bd2;">include</span>         /etc/openldap/schema/inetorgperson.schema
<span style="color: #268bd2;">include</span>         /etc/openldap/schema/nis.schema
<span style="color: #268bd2;">include</span>         /etc/openldap/schema/sudo.schema

<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Allow LDAPv2 client connections.  This is NOT the default.</span>
<span style="color: #268bd2;">allow</span> bind_v2

<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Do not enable referrals until AFTER you have a working directory</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">service AND an understanding of referrals.</span>
<span style="color: #93a1a1;">#</span><span style="color: #93a1a1;">referral       ldap://root.openldap.org</span>

<span style="color: #268bd2;">pidfile</span>         /var/run/openldap/slapd.pid
<span style="color: #268bd2;">argsfile</span>        /var/run/openldap/slapd.args

<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Load dynamic backend modules:</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">modulepath    /usr/lib64/openldap</span>

<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Modules available in openldap-servers-overlays RPM package</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Module syncprov.la is now statically linked with slapd and there</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">is no need to load it here</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">moduleload accesslog.la</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">moduleload auditlog.la</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">moduleload denyop.la</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">moduleload dyngroup.la</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">moduleload dynlist.la</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">moduleload lastmod.la</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">moduleload pcache.la</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">moduleload ppolicy.la</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">moduleload refint.la</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">moduleload retcode.la</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">moduleload rwm.la</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">moduleload smbk5pwd.la</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">moduleload translucent.la</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">moduleload unique.la</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">moduleload valsort.la</span>

<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">modules available in openldap-servers-sql RPM package:</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">moduleload back_sql.la</span>

<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">The next three lines allow use of TLS for encrypting connections using a</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">dummy test certificate which you can generate by changing to</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">/etc/pki/tls/certs, running "make slapd.pem", and fixing permissions on</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">slapd.pem so that the ldap user or group can read it.  Your client software</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">may balk at self-signed certificates, however.</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">TLSCACertificateFile /etc/pki/tls/certs/ca-bundle.crt</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">TLSCertificateFile /etc/pki/tls/certs/slapd.pem</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">TLSCertificateKeyFile /etc/pki/tls/certs/slapd.pem</span>

<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Sample security restrictions</span>
<span style="color: #93a1a1;">#       </span><span style="color: #93a1a1;">Require integrity protection (prevent hijacking)</span>
<span style="color: #93a1a1;">#       </span><span style="color: #93a1a1;">Require 112-bit (3DES or better) encryption for updates</span>
<span style="color: #93a1a1;">#       </span><span style="color: #93a1a1;">Require 63-bit encryption for simple bind</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">security ssf=1 update_ssf=112 simple_bind=64</span>

<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Sample access control policy:</span>
<span style="color: #93a1a1;">#       </span><span style="color: #93a1a1;">Root DSE: allow anyone to read it</span>
<span style="color: #93a1a1;">#       </span><span style="color: #93a1a1;">Subschema (sub)entry DSE: allow anyone to read it</span>
<span style="color: #93a1a1;">#       </span><span style="color: #93a1a1;">Other DSEs:</span>
<span style="color: #93a1a1;">#               </span><span style="color: #93a1a1;">Allow self write access</span>
<span style="color: #93a1a1;">#               </span><span style="color: #93a1a1;">Allow authenticated users read access</span>
<span style="color: #93a1a1;">#               </span><span style="color: #93a1a1;">Allow anonymous users to authenticate</span>
<span style="color: #93a1a1;">#       </span><span style="color: #93a1a1;">Directives needed to implement policy:</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">access to dn.base="" by * read</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">access to dn.base="cn=Subschema" by * read</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">access to *</span>
<span style="color: #93a1a1;">#       </span><span style="color: #93a1a1;">by self write</span>
<span style="color: #93a1a1;">#       </span><span style="color: #93a1a1;">by users read</span>
<span style="color: #93a1a1;">#       </span><span style="color: #93a1a1;">by anonymous auth</span>
<span style="color: #93a1a1;">#</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">if no access controls are present, the default policy</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">allows anyone and everyone to read anything but restricts</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">updates to rootdn.  (e.g., "access to * by * read")</span>
<span style="color: #93a1a1;">#</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">rootdn can always read and write EVERYTHING!</span>

<span style="color: #93a1a1;">#######################################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">ldbm and/or bdb database definitions</span>
<span style="color: #93a1a1;">#######################################################################</span>
<span style="color: #268bd2;">database</span>        config
<span style="color: #268bd2;">rootdn</span>          <span style="color: #2aa198;">"cn=Manager,cn=config"</span>
<span style="color: #268bd2;">rootpw</span>          %LDAP_ROOT_PASSWORD%

<span style="color: #268bd2;">database</span> monitor

<span style="color: #268bd2;">database</span>        hdb
<span style="color: #268bd2;">suffix</span>          <span style="color: #2aa198;">"dc=my-domain,dc=com"</span>
<span style="color: #268bd2;">rootdn</span>          <span style="color: #2aa198;">"cn=Manager,dc=my-domain,dc=com"</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Cleartext passwords, especially for the rootdn, should</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">be avoided.  See slappasswd(8) and slapd.conf(5) for details.</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Use of strong authentication encouraged.</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">rootpw                secret</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">rootpw                {crypt}ijFYNcSNctBYg</span>

<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">The database directory MUST exist prior to running slapd AND </span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">should only be accessible by the slapd and slap tools.</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Mode 700 recommended.</span>
<span style="color: #268bd2;">directory</span>       /var/lib/ldap

<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Indices to maintain for this database</span>
<span style="color: #268bd2;">index</span> objectClass                       eq,pres
<span style="color: #268bd2;">index</span> ou,cn,mail,surname,givenname      eq,pres,sub
<span style="color: #268bd2;">index</span> uidNumber,gidNumber,loginShell    eq,pres
<span style="color: #268bd2;">index</span> uid,memberUid                     eq,pres,sub
<span style="color: #268bd2;">index</span> nisMapName,nisMapEntry            eq,pres,sub

<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Replicas of this database</span>
<span style="color: #93a1a1;">#</span><span style="color: #93a1a1;">replogfile /var/lib/ldap/openldap-master-replog</span>
<span style="color: #93a1a1;">#</span><span style="color: #93a1a1;">replica host=ldap-1.example.com:389 starttls=critical</span>
<span style="color: #93a1a1;">#     </span><span style="color: #93a1a1;">bindmethod=sasl saslmech=GSSAPI</span>
<span style="color: #93a1a1;">#     </span><span style="color: #93a1a1;">authcId=host/ldap-master.example.com@EXAMPLE.COM</span>
</pre>
</div>
</div>
<div class="org-src-container">
<label class="org-src-name">Настройка <b>conf</b>-файла для <b>5/2.3</b></label>
<pre class="src src-diff"><span style="background-color: #fdf6e3;">8a9</span>
<span style="color: #859900;">&gt;</span><span style="color: #859900;"> include               /etc/openldap/schema/sudo.schema</span>
<span style="background-color: #fdf6e3;">83a85,87</span>
<span style="color: #859900;">&gt;</span><span style="color: #859900;"> database      config</span>
<span style="color: #859900;">&gt;</span><span style="color: #859900;"> rootdn                "cn=Manager,cn=config"</span>
<span style="color: #859900;">&gt;</span><span style="color: #859900;"> rootpw                {SSHA}GJsR+eNVKIwqK4ef6lmAo58pHjgLkIx+</span>
<span style="background-color: #fdf6e3;">85c89,91</span>
<span style="color: #dc322f;">&lt;</span><span style="color: #dc322f;"> database      bdb</span>
<span style="background-color: #fdf6e3;">---</span>
<span style="color: #859900;">&gt;</span><span style="color: #859900;"> database monitor</span>
<span style="color: #859900;">&gt;</span><span style="color: #859900;"> </span>
<span style="color: #859900;">&gt;</span><span style="color: #859900;"> database      hdb</span>
</pre>
</div>
<p>
и произведем первый запуск сервиса
</p>
<div class="org-src-container">
<label class="org-src-name">Первый запуск сервиса для <b>5/2.3</b></label>
<pre class="src src-sh">    mv /etc/openldap/slapd.conf /etc/openldap/slapd.conf.original
    cp /root/slapd.conf /etc/openldap/slapd.conf
    <span style="color: #268bd2;">ROOT_PWD</span>=$(<span style="color: #6c71c4; font-weight: bold;">slappasswd</span> -s $<span style="color: #268bd2;">LDAP_ROOT_PASSWORD</span>)
    <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Use bash variable substitution to escape special chars http://stackoverflow.com/a/14339705</span>
    sed -i <span style="color: #2aa198;">"s+%LDAP_ROOT_PASSWORD%+${ROOT_PWD//+/\\+}+"</span> /etc/openldap/slapd.conf
    chown ldap. /etc/openldap/slapd.conf

    diff /etc/openldap/slapd.conf.original /etc/openldap/slapd.conf &gt; /gen/slapd.diff || true
    service ldap start
</pre>
</div>
<p>
Выполним аналогичные действия для <b>6/2.4</b>
</p>

<div align="right">
<a onclick="toggleDiv2('myContent2',$(this));" class="fa fa-caret-right">/root/slapd.conf.obsolete</a>
</div>
<div id="myContent2" style="display:none">
<div class="org-src-container">
<label class="org-src-name">Конфигурационный файл для <b>6/2.4</b></label>
<pre class="src src-conf-space"><span style="color: #93a1a1;">#</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">See slapd.conf(5) for details on configuration options.</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">This file should NOT be world readable.</span>
<span style="color: #93a1a1;">#</span>

<span style="color: #268bd2;">include</span>         /etc/openldap/schema/corba.schema
<span style="color: #268bd2;">include</span>         /etc/openldap/schema/core.schema
<span style="color: #268bd2;">include</span>         /etc/openldap/schema/cosine.schema
<span style="color: #268bd2;">include</span>         /etc/openldap/schema/duaconf.schema
<span style="color: #268bd2;">include</span>         /etc/openldap/schema/dyngroup.schema
<span style="color: #268bd2;">include</span>         /etc/openldap/schema/inetorgperson.schema
<span style="color: #268bd2;">include</span>         /etc/openldap/schema/java.schema
<span style="color: #268bd2;">include</span>         /etc/openldap/schema/misc.schema
<span style="color: #268bd2;">include</span>         /etc/openldap/schema/nis.schema
<span style="color: #268bd2;">include</span>         /etc/openldap/schema/openldap.schema
<span style="color: #268bd2;">include</span>         /etc/openldap/schema/ppolicy.schema
<span style="color: #268bd2;">include</span>         /etc/openldap/schema/collective.schema
<span style="color: #268bd2;">include</span>         /etc/openldap/schema/sudo.schema

<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Allow LDAPv2 client connections.  This is NOT the default.</span>
<span style="color: #268bd2;">allow</span> bind_v2

<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Do not enable referrals until AFTER you have a working directory</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">service AND an understanding of referrals.</span>
<span style="color: #93a1a1;">#</span><span style="color: #93a1a1;">referral       ldap://root.openldap.org</span>

<span style="color: #268bd2;">pidfile</span>         /var/run/openldap/slapd.pid
<span style="color: #268bd2;">argsfile</span>        /var/run/openldap/slapd.args

<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Load dynamic backend modules</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">- modulepath is architecture dependent value (32/64-bit system)</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">- back_sql.la overlay requires openldap-server-sql package</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">- dyngroup.la and dynlist.la cannot be used at the same time</span>

<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">modulepath /usr/lib/openldap</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">modulepath /usr/lib64/openldap</span>

<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">moduleload accesslog.la</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">moduleload auditlog.la</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">moduleload back_sql.la</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">moduleload chain.la</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">moduleload collect.la</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">moduleload constraint.la</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">moduleload dds.la</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">moduleload deref.la</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">moduleload dyngroup.la</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">moduleload dynlist.la</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">moduleload memberof.la</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">moduleload pbind.la</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">moduleload pcache.la</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">moduleload ppolicy.la</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">moduleload refint.la</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">moduleload retcode.la</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">moduleload rwm.la</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">moduleload seqmod.la</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">moduleload smbk5pwd.la</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">moduleload sssvlv.la</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">moduleload syncprov.la</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">moduleload translucent.la</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">moduleload unique.la</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">moduleload valsort.la</span>

<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">The next three lines allow use of TLS for encrypting connections using a</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">dummy test certificate which you can generate by running</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">/usr/libexec/openldap/generate-server-cert.sh. Your client software may balk</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">at self-signed certificates, however.</span>
<span style="color: #268bd2;">TLSCACertificatePath</span> /etc/openldap/certs
<span style="color: #268bd2;">TLSCertificateFile</span> <span style="color: #2aa198;">"\"OpenLDAP Server\""</span>
<span style="color: #268bd2;">TLSCertificateKeyFile</span> /etc/openldap/certs/password

<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Sample security restrictions</span>
<span style="color: #93a1a1;">#       </span><span style="color: #93a1a1;">Require integrity protection (prevent hijacking)</span>
<span style="color: #93a1a1;">#       </span><span style="color: #93a1a1;">Require 112-bit (3DES or better) encryption for updates</span>
<span style="color: #93a1a1;">#       </span><span style="color: #93a1a1;">Require 63-bit encryption for simple bind</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">security ssf=1 update_ssf=112 simple_bind=64</span>

<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Sample access control policy:</span>
<span style="color: #93a1a1;">#       </span><span style="color: #93a1a1;">Root DSE: allow anyone to read it</span>
<span style="color: #93a1a1;">#       </span><span style="color: #93a1a1;">Subschema (sub)entry DSE: allow anyone to read it</span>
<span style="color: #93a1a1;">#       </span><span style="color: #93a1a1;">Other DSEs:</span>
<span style="color: #93a1a1;">#               </span><span style="color: #93a1a1;">Allow self write access</span>
<span style="color: #93a1a1;">#               </span><span style="color: #93a1a1;">Allow authenticated users read access</span>
<span style="color: #93a1a1;">#               </span><span style="color: #93a1a1;">Allow anonymous users to authenticate</span>
<span style="color: #93a1a1;">#       </span><span style="color: #93a1a1;">Directives needed to implement policy:</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">access to dn.base="" by * read</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">access to dn.base="cn=Subschema" by * read</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">access to *</span>
<span style="color: #93a1a1;">#       </span><span style="color: #93a1a1;">by self write</span>
<span style="color: #93a1a1;">#       </span><span style="color: #93a1a1;">by users read</span>
<span style="color: #93a1a1;">#       </span><span style="color: #93a1a1;">by anonymous auth</span>
<span style="color: #93a1a1;">#</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">if no access controls are present, the default policy</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">allows anyone and everyone to read anything but restricts</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">updates to rootdn.  (e.g., "access to * by * read")</span>
<span style="color: #93a1a1;">#</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">rootdn can always read and write EVERYTHING!</span>

<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">enable on-the-fly configuration (cn=config)</span>
<span style="color: #268bd2;">database</span> config
<span style="color: #268bd2;">access</span> to *
        <span style="color: #268bd2;">by</span> dn.exact=<span style="color: #2aa198;">"gidNumber=0+uidNumber=0,cn=peercred,cn=external,cn=auth"</span> manage
        <span style="color: #268bd2;">by</span> * none

<span style="color: #268bd2;">rootdn</span>          <span style="color: #2aa198;">"cn=Manager,cn=config"</span>
<span style="color: #268bd2;">rootpw</span>          %LDAP_ROOT_PASSWORD%

<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">enable server status monitoring (cn=monitor)</span>
<span style="color: #268bd2;">database</span> monitor
<span style="color: #268bd2;">access</span> to *
        <span style="color: #268bd2;">by</span> dn.exact=<span style="color: #2aa198;">"gidNumber=0+uidNumber=0,cn=peercred,cn=external,cn=auth"</span> read
        <span style="color: #268bd2;">by</span> dn.exact=<span style="color: #2aa198;">"cn=Manager,dc=my-domain,dc=com"</span> read
        <span style="color: #268bd2;">by</span> * none

<span style="color: #93a1a1;">#######################################################################</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">database definitions</span>
<span style="color: #93a1a1;">#######################################################################</span>

<span style="color: #268bd2;">database</span>        hdb
<span style="color: #268bd2;">suffix</span>          <span style="color: #2aa198;">"dc=my-domain,dc=com"</span>
<span style="color: #268bd2;">checkpoint</span>      1024 15
<span style="color: #268bd2;">rootdn</span>          <span style="color: #2aa198;">"cn=Manager,dc=my-domain,dc=com"</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Cleartext passwords, especially for the rootdn, should</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">be avoided.  See slappasswd(8) and slapd.conf(5) for details.</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Use of strong authentication encouraged.</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">rootpw                secret</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">rootpw                {crypt}ijFYNcSNctBYg</span>

<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">The database directory MUST exist prior to running slapd AND </span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">should only be accessible by the slapd and slap tools.</span>
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Mode 700 recommended.</span>
<span style="color: #268bd2;">directory</span>       /var/lib/ldap

<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Indices to maintain for this database</span>
<span style="color: #268bd2;">index</span> objectClass                       eq,pres
<span style="color: #268bd2;">index</span> ou,cn,mail,surname,givenname      eq,pres,sub
<span style="color: #268bd2;">index</span> uidNumber,gidNumber,loginShell    eq,pres
<span style="color: #268bd2;">index</span> uid,memberUid                     eq,pres,sub
<span style="color: #268bd2;">index</span> nisMapName,nisMapEntry            eq,pres,sub

<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Replicas of this database</span>
<span style="color: #93a1a1;">#</span><span style="color: #93a1a1;">replogfile /var/lib/ldap/openldap-master-replog</span>
<span style="color: #93a1a1;">#</span><span style="color: #93a1a1;">replica host=ldap-1.example.com:389 starttls=critical</span>
<span style="color: #93a1a1;">#     </span><span style="color: #93a1a1;">bindmethod=sasl saslmech=GSSAPI</span>
<span style="color: #93a1a1;">#     </span><span style="color: #93a1a1;">authcId=host/ldap-master.example.com@EXAMPLE.COM</span>
</pre>
</div>
</div>
<div class="org-src-container">
<label class="org-src-name">Настройка <b>conf</b>-файла для <b>6/2.4</b></label>
<pre class="src src-diff"><span style="background-color: #fdf6e3;">17a18</span>
<span style="color: #859900;">&gt;</span><span style="color: #859900;"> include               /etc/openldap/schema/sudo.schema</span>
<span style="background-color: #fdf6e3;">102a104,106</span>
<span style="color: #859900;">&gt;</span><span style="color: #859900;"> rootdn                "cn=Manager,cn=config"</span>
<span style="color: #859900;">&gt;</span><span style="color: #859900;"> rootpw          {SSHA}aAS4N23RBN7Bl7DNO0S4TykVh5v9YY6G</span>
<span style="color: #859900;">&gt;</span><span style="color: #859900;"> </span>
<span style="background-color: #fdf6e3;">114c118</span>
<span style="color: #dc322f;">&lt;</span><span style="color: #dc322f;"> database      bdb</span>
<span style="background-color: #fdf6e3;">---</span>
<span style="color: #859900;">&gt;</span><span style="color: #859900;"> database      hdb</span>
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name">Первый запуск сервиса для <b>6/2.4</b></label>
<pre class="src src-sh">    cp /root/slapd.conf.obsolete /etc/openldap/slapd.conf
    <span style="color: #268bd2;">ROOT_PWD</span>=$(<span style="color: #6c71c4; font-weight: bold;">slappasswd</span> -s $<span style="color: #268bd2;">LDAP_ROOT_PASSWORD</span>)
    <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Use bash variable substitution to escape special chars http://stackoverflow.com/a/14339705</span>
    sed -i <span style="color: #2aa198;">"s+%LDAP_ROOT_PASSWORD%+${ROOT_PWD//+/\\+}+"</span> /etc/openldap/slapd.conf
    chown ldap. /etc/openldap/slapd.conf
    rm -rf /etc/openldap/slapd.d

    diff /usr/share/openldap-servers/slapd.conf.obsolete /etc/openldap/slapd.conf &gt; /gen/slapd.obsolete.diff || true
    service slapd start
</pre>
</div>

<p>
<a id="orgtarget1"></a>Теперь для обеих конфигураций можно осуществить переход к <b>cn=config</b> формату и избавиться от <b>slapd.conf</b>
</p>
<div class="org-src-container">
<label class="org-src-name">Преобразование к <b>cn=config</b> формату для <b>5/2.3</b> и <b>6/2.4</b></label>
<pre class="src src-sh">    sleep 3

    <span style="color: #657b83; font-weight: bold;">kill</span> -INT <span style="color: #6c71c4; font-weight: bold;">`cat /var/run/openldap/slapd.pid`</span>
    rm -rf /etc/openldap/slapd.d
    <span style="color: #268bd2;">oldpath</span>=<span style="color: #6c71c4; font-weight: bold;">`pwd`</span>
    <span style="color: #657b83; font-weight: bold;">cd</span> /etc/openldap
    mkdir slapd.d
    slaptest -f slapd.conf -F slapd.d
    chown -R ldap:ldap slapd.d
    chmod -R 0750 slapd.d
    mv slapd.conf slapd.conf.bak
    <span style="color: #657b83; font-weight: bold;">cd</span> $<span style="color: #268bd2;">oldpath</span>
</pre>
</div>
<p>
После перезапуска, для <b>5/2.3</b>
</p>
<div class="org-src-container">

<pre class="src src-sh">    service ldap start
</pre>
</div>
<p>
и для <b>6/2.4</b>
</p>
<div class="org-src-container">

<pre class="src src-sh">    service slapd start
</pre>
</div>
<p>
получаем сервисы, отличающиеся только настройками по умолчанию,
поставляемыми из базовых репозиториев в файлах
<b>/etc/openldap/slapd.conf</b> (<b>5/2.3</b>) и
<b>/usr/share/openldap-servers/slapd.conf.obsolete</b> (<b>6/2.4</b>).
</p>

<p>
Дальнейшая настройка схемы осуществляется в разделе <a href="#schema">3</a>.
</p>
</div>
</div>
<div id="outline-container-orgheadline7" class="outline-3">
<h3 id="configure-slapd"><a id="orgheadline7"></a><a id="ID-fd3e3e26-d416-4cc5-9dfa-554caeaf7830"></a><span class="section-number-3">1.6</span> Дополнительно. Предварительная настройка схемы БД LDAP с помощью ldif формата</h3>
<div class="outline-text-3" id="text-configure-slapd">
<p>
Продемонстрируем второй способ настройки для обеих конфигураций.
</p>

<p>
Конфигурация <b>5/2.3</b> поставляется со схемами только в <b>schema</b>
формате, а <b>6/2.4</b> &#x2014; как в <b>schema</b>, так и в <b>ldif</b> формате. Файл
<b>sudo.schema</b> доступен только в <b>schema</b> формате. С помощью скрипта
<b>2.5-schema-ldif.sh</b><sup><a id="fnr.3" class="footref" href="#fn.3">3</a></sup>
преобразуем необходимые схемы. Чтобы иметь доступ к серверу LDAP для
конфигурирования схемы БД LDAP, пропишем пароль менеджера схемы
<b>cn=Manager,cn=config</b>. Пользователь <b>rootdn</b> имеет права на чтение и
запись для всего содержимого. Кроме того, добавим минимальные
настройки для <b>monitor</b> и настроим базу <b>hdb</b>. Используем
"оффлайновую" утилиту <b>slapadd</b> для создания минимума конфигурационных
настроек, позволяющих запустить сервер.
</p>

<div class="org-src-container">
<label class="org-src-name">Преобразование схем в <b>ldif</b> формат и задание начальной конфигурации</label>
<pre class="src src-sh">    rm -rf /etc/openldap/slapd.d
    rm -f /etc/openldap/slapd.conf
    mkdir -p /etc/openldap/slapd.d

    <span style="color: #268bd2;">oldpath</span>=<span style="color: #6c71c4; font-weight: bold;">`pwd`</span>
    <span style="color: #657b83; font-weight: bold;">cd</span> /etc/openldap/schema
    <span style="color: #268bd2;">SCHEMAD</span>=<span style="color: #6c71c4; font-weight: bold;">`pwd`</span> <span style="color: #268bd2;">SCHEMAS</span>=<span style="color: #2aa198;">'core.schema cosine.schema inetorgperson.schema nis.schema sudo.schema'</span> /root/2.5-schema-ldif.sh
    cp -R /etc/openldap/schema /gen/schema
    <span style="color: #657b83; font-weight: bold;">cd</span> $<span style="color: #268bd2;">oldpath</span>

    <span style="color: #268bd2;">ROOT_PWD</span>=$(<span style="color: #6c71c4; font-weight: bold;">slappasswd</span> -s $<span style="color: #268bd2;">LDAP_ROOT_PASSWORD</span>)
    <span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Use bash variable substitution to escape special chars http://stackoverflow.com/a/14339705</span>
    sed -i <span style="color: #2aa198;">"s+%LDAP_ROOT_PASSWORD%+${ROOT_PWD//+/\\+}+"</span> /root/slapd.ldif
    slapadd -b <span style="color: #268bd2;">cn</span>=config -F /etc/openldap/slapd.d -l /root/slapd.ldif || true
    chown -R ldap. /etc/openldap/slapd.d/
</pre>
</div>
<div class="org-src-container">
<label class="org-src-name"><b>slapd.ldif</b>: формирование корневой записи DIT и контейнера для наборов схем данных; конфигурирование базы данных <b>hdb</b> и подключение мониторинга баз данных</label>
<pre class="src src-ldif" id="orgsrcblock1"><span style="color: #859900; font-weight: bold;">dn</span>: <span style="color: #268bd2;">cn=config</span>
objectClass: olcGlobal
olcPidFile: /var/run/openldap/slapd.pid
olcArgsFile: /var/run/openldap/slapd.args
cn: config

<span style="color: #859900; font-weight: bold;">dn</span>: <span style="color: #268bd2;">olcDatabase={0}config,cn=config</span>
objectClass: olcDatabaseConfig
olcDatabase: {0}config
olcRootDN: cn=Manager,cn=config
olcRootPW: %LDAP_ROOT_PASSWORD%

<span style="color: #859900; font-weight: bold;">dn</span>: <span style="color: #268bd2;">cn=schema,cn=config</span>
objectClass: olcSchemaConfig
cn: schema

include: file:///etc/openldap/schema/core.ldif
include: file:///etc/openldap/schema/cosine.ldif
include: file:///etc/openldap/schema/inetorgperson.ldif
include: file:///etc/openldap/schema/nis.ldif
include: file:///etc/openldap/schema/sudo.ldif

<span style="color: #859900; font-weight: bold;">dn</span>: <span style="color: #268bd2;">olcDatabase=monitor,cn=config</span>
objectClass: olcDatabaseConfig
olcDatabase: monitor

<span style="color: #859900; font-weight: bold;">dn</span>: <span style="color: #268bd2;">olcDatabase=hdb,cn=config</span>
objectClass: olcDatabaseConfig
objectClass: olcHdbConfig
olcDatabase: hdb
olcSuffix: dc=my-domain,dc=com
olcRootDN: cn=Manager,dc=my-domain,dc=com
olcDbDirectory: /var/lib/ldap
olcDbIndex: objectClass                       eq,pres
olcDbIndex: ou,cn,mail,surname,givenname      eq,pres,sub
olcDbIndex: uidNumber,gidNumber,loginShell    eq,pres
olcDbIndex: uid,memberUid                     eq,pres,sub
olcDbIndex: nisMapName,nisMapEntry            eq,pres,sub
</pre>
</div>

<p>
После перезапуска, для <b>5/2.3</b>
</p>
<div class="org-src-container">

<pre class="src src-sh">    service ldap start
</pre>
</div>
<p>
и для <b>6/2.4</b>
</p>
<div class="org-src-container">

<pre class="src src-sh">    service slapd start
</pre>
</div>
<p>
получаем сервисы, отличающиеся только настройками схемы, содержащимися
в исходных кодах разных версий <b>OpenLDAP</b>.  Например, для конфигурации
<b>5/2.3</b> требуется добавить настройки <b>frontend</b> базы, а для <b>6/2.4</b>
эти настройки добавляются автоматически из исходного кода <b>OpenLDAP</b>
(что, кстати говоря, несколько нарушает прозрачность &#x2014; появляется то,
что явно не указано в <b>slapd.ldif</b> файле). Вероятно, это потому, что версия
<b>2.4</b> официально поддерживает конфигурирование с помощью <b>slapadd</b> и
<b>ldif</b> формат. Для версии <b>2.3</b> официально поддерживаемым является
способ конфигурирования через <b>conf</b> файл. Все дальнейшие изменения
уже осуществляются с помощью "онлайновых" утилит <b>ldapadd</b> и
<b>ldapmodify</b>.
</p>

<div class="org-src-container">
<label class="org-src-name">Добавление <b>frontend</b> для <b>5/2.3</b></label>
<pre class="src src-sh">    sleep 2

    ldapadd -v -D <span style="color: #268bd2;">cn</span>=Manager,<span style="color: #268bd2;">cn</span>=config -f /root/front.ldif -x -w $<span style="color: #268bd2;">LDAP_ROOT_PASSWORD</span> || true
</pre>
</div>

<p>
Специальная база данных <b>frontend</b> содержит настройки, которые применяются глобально ко всем остальным базам данных. В нашем случае это база <b>hdb</b>.
</p>

<div class="org-src-container">
<label class="org-src-name"><b>front.ldif</b>: добавление служебной базы данных <b>frontend</b> (только для <b>5/2.3</b>)</label>
<pre class="src src-ldif" id="orgsrcblock2"><span style="color: #859900; font-weight: bold;">dn</span>: <span style="color: #268bd2;">olcDatabase={-1}frontend,cn=config</span>
objectClass: olcDatabaseConfig
objectClass: olcFrontendConfig
olcSchemaDN: cn=Subschema
olcDatabase: {-1}frontend
</pre>
</div>

<p>
Дальнейшая настройка схемы осуществляется в разделе <a href="#schema">3</a>.
</p>
</div>
</div>
</div>
<div id="outline-container-orgheadline18" class="outline-2">
<h2 id="authentification"><a id="orgheadline18"></a><a id="ID-49b5e2df-0c06-445a-ae9e-66bcd6cc9e40"></a><span class="section-number-2">2</span> Настройка аутентификации пользователей при помощи LDAP&nbsp;<sup><i class="fa fa-star-half-o"></i></sup></h2>
<div class="outline-text-2" id="text-authentification">
<blockquote>
<p>
Необходимо разработать документацию по настройке аутентификации пользователей при помощи LDAP в ОС <b>CentOS 5</b>. Проверить работоспособность выработанных инструкций в ОС <b>CentOS 6</b>.
</p>

<p>
В документацию должно входить:
</p>

<ul class="org-ul">
<li>Список пакетов, которые необходимо установить;</li>
<li>Список файлов, модификация которых необходима для настройки процесса аутентификации посредством LDAP;</li>
<li>Описание всех опций, выставляемых в этих файлах.</li>
</ul>
</blockquote>

<p>
Рассмотрим три задачи, возникающие при настройке аутентификации
пользователей при помощи LDAP. Чтобы провести аутентификацию
пользователя необходимо, чтобы клиентский хост имел
право на чтение пользовательских данных на сервере LDAP. Для этого
потребуется обеспечить механизм аутентификации клиентского хоста при
помощи LDAP. Далее следует основная задача &#x2014; это, собственно, настройка
аутентификации пользователей в системе при помощи LDAP. И, наконец,
вспомогательная задача аутентификации пользователя с повышением прав.
</p>
</div>

<div id="outline-container-orgheadline9" class="outline-3">
<h3 id="client-packages"><a id="orgheadline9"></a><a id="ID-a4da4894-117b-40b6-a6c7-1447f083d6e1"></a><span class="section-number-3">2.1</span> Требуемые пакеты</h3>
<div class="outline-text-3" id="text-client-packages">
<p>
Для настройки клиентского подключения в <b>5/2.3</b> понадобятся следующие пакеты
</p>

<div class="org-src-container">
<label class="org-src-name">Установка клиента для <b>5/2.3</b></label>
<pre class="src src-sh">yum install -y openssh-server openldap-clients nss_ldap authconfig
yum install -y openldap openldap-servers sudo
</pre>
</div>

<p>
Здесь также необходим пакет <b>openldap-servers</b>, поскольку утилиты для миграции пользователей содержатся в нем. Для <b>6/2.4</b> выполним
</p>

<div class="org-src-container">
<label class="org-src-name">Установка клиента для <b>6/2.4</b></label>
<pre class="src src-sh">yum install -y openssh-server openldap-clients nss-pam-ldapd authconfig
yum install -y openldap migrationtools sudo
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline10" class="outline-3">
<h3 id="client-commands"><a id="orgheadline10"></a><a id="ID-6e7a8278-7334-46f7-b289-07da7f2b6d14"></a><span class="section-number-3">2.2</span> Используемые команды&nbsp;<sup><i class="fa fa-star"></i></sup></h3>
<div class="outline-text-3" id="text-client-commands">
<p>
Воспользуемся утилитой <b>authconfig</b> для настройки аутентификации пользователей при помощи LDAP.
</p>

<p>
В конфигурации <b>5/2.3</b> приходится использовать параметр
<b>enableshadow</b>, поскольку эта функциональность отключена по
умолчанию. Отдельно укажем параметр <b>sudoers_base</b> и параметры
<b>binddn</b> и <b>bindpw</b> в настройках для <b>pam_ldap</b>.
</p>

<div class="org-src-container">
<label class="org-src-name">Настройка клиента для <b>5/2.3</b></label>
<pre class="src src-sh">authconfig --enableshadow --enablemkhomedir --enableldap --enableldapauth <span style="color: #b58900; font-weight: bold;">\</span>
           --ldapserver=$<span style="color: #268bd2;">LDAP_SERVER</span> --ldapbasedn=$<span style="color: #268bd2;">LDAP_BASEDN</span> --update

<span style="color: #657b83; font-weight: bold;">echo</span> sudoers_base <span style="color: #268bd2;">dc</span>=mercury,<span style="color: #268bd2;">dc</span>=febras,<span style="color: #268bd2;">dc</span>=net &gt;&gt; /etc/ldap.conf
<span style="color: #657b83; font-weight: bold;">echo</span> sudoers_debug 0 &gt;&gt; /etc/ldap.conf
<span style="color: #657b83; font-weight: bold;">echo</span> binddn <span style="color: #268bd2;">cn</span>=authenticator,<span style="color: #268bd2;">dc</span>=mercury,<span style="color: #268bd2;">dc</span>=febras,<span style="color: #268bd2;">dc</span>=net &gt;&gt; /etc/ldap.conf
<span style="color: #657b83; font-weight: bold;">echo</span> bindpw secret &gt;&gt; /etc/ldap.conf
</pre>
</div>

<p>
Для конфигурации <b>6/2.4</b> приходится отдельно прописывать параметр
<b>sudoers</b> для <b>nsswitch.conf</b>, а в конфигурации <b>5/2.3</b> он уже
появляется после установки пакетов, еще до запуска <b>authconfig</b>. Для
настройки <b>sudo</b> дополнительно указываются параметры <b>uri</b> и <b>base</b>,
поскольку файл теперь другой &#x2014; <b>sudo-ldap.conf</b>. А параметры
<b>binddn</b> и <b>bindpw</b> необходимо указать в 3х файлах: <b>nslcd.conf</b>,
<b>pam_ldap.conf</b> и <b>sudo-ldap.conf</b>.
</p>

<div class="org-src-container">
<label class="org-src-name">Настройка клиента для <b>6/2.4</b></label>
<pre class="src src-sh">authconfig --enablemkhomedir --enableldap --enableldapauth <span style="color: #b58900; font-weight: bold;">\</span>
           --ldapserver=$<span style="color: #268bd2;">LDAP_SERVER</span> --ldapbasedn=$<span style="color: #268bd2;">LDAP_BASEDN</span> --update

<span style="color: #657b83; font-weight: bold;">echo</span> sudoers:  files ldap &gt;&gt; /etc/nsswitch.conf

<span style="color: #657b83; font-weight: bold;">echo</span> uri ldap://$<span style="color: #268bd2;">LDAP_SERVER</span>/ &gt;&gt; /etc/sudo-ldap.conf
<span style="color: #657b83; font-weight: bold;">echo</span> base <span style="color: #268bd2;">dc</span>=mercury,<span style="color: #268bd2;">dc</span>=febras,<span style="color: #268bd2;">dc</span>=net &gt;&gt; /etc/sudo-ldap.conf
<span style="color: #657b83; font-weight: bold;">echo</span> sudoers_base <span style="color: #268bd2;">dc</span>=mercury,<span style="color: #268bd2;">dc</span>=febras,<span style="color: #268bd2;">dc</span>=net &gt;&gt; /etc/sudo-ldap.conf
<span style="color: #657b83; font-weight: bold;">echo</span> sudoers_debug 0 &gt;&gt; /etc/sudo-ldap.conf
<span style="color: #657b83; font-weight: bold;">echo</span> binddn <span style="color: #268bd2;">cn</span>=authenticator,<span style="color: #268bd2;">dc</span>=mercury,<span style="color: #268bd2;">dc</span>=febras,<span style="color: #268bd2;">dc</span>=net &gt;&gt; /etc/sudo-ldap.conf
<span style="color: #657b83; font-weight: bold;">echo</span> bindpw secret &gt;&gt; /etc/sudo-ldap.conf

<span style="color: #657b83; font-weight: bold;">echo</span> binddn <span style="color: #268bd2;">cn</span>=authenticator,<span style="color: #268bd2;">dc</span>=mercury,<span style="color: #268bd2;">dc</span>=febras,<span style="color: #268bd2;">dc</span>=net &gt;&gt; /etc/pam_ldap.conf
<span style="color: #657b83; font-weight: bold;">echo</span> bindpw secret &gt;&gt; /etc/pam_ldap.conf

<span style="color: #657b83; font-weight: bold;">echo</span> binddn <span style="color: #268bd2;">cn</span>=authenticator,<span style="color: #268bd2;">dc</span>=mercury,<span style="color: #268bd2;">dc</span>=febras,<span style="color: #268bd2;">dc</span>=net &gt;&gt; /etc/nslcd.conf
<span style="color: #657b83; font-weight: bold;">echo</span> bindpw secret &gt;&gt; /etc/nslcd.conf

/etc/init.d/nslcd stop
rm /var/run/nslcd/*
/etc/init.d/nslcd start
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline11" class="outline-3">
<h3 id="client-files"><a id="orgheadline11"></a><a id="ID-386e40de-d1f2-4dc8-994b-5870d4ec42fb"></a><span class="section-number-3">2.3</span> Изменяемые файлы&nbsp;<sup><i class="fa fa-star"></i></sup></h3>
<div class="outline-text-3" id="text-client-files">
<p>
Файлы, которые были модифицированы настройками раздела <a href="#client-commands">2.2</a> в случае <b>5/2.3</b>
</p>

<ul class="org-ul">
<li><b>nsswitch.conf</b> &#x2014; файл с настройками системных баз данных (в
т.ч. порядка их просмотра) для диспетчера службы имен. Можно
указывать спецификации службы, такие как <b>files</b>, <b>ldap</b>.</li>
<li><b>/etc/ldap.conf</b> &#x2014; конфигурационный файл для <b>pam_ldap</b>.</li>
<li><b>/etc/openldap/ldap.conf</b> &#x2014; конфигурационный файл для установки
общесистемных настроек ldap-клиентов.</li>
<li><b>system-auth</b> &#x2014; назначением этого файла является
обеспечение общей конфигурации для всех приложений и сервисов,
вызывающих библиотеку <b>PAM</b>.</li>
</ul>

<div class="org-src-container">
<label class="org-src-name">Список измененных файлов для <b>5/2.3</b></label>
<pre class="src src-diff"><span style="color: #93a1a1;">/etc/group</span>
<span style="color: #93a1a1;">/etc/group-</span>
<span style="color: #93a1a1;">/etc/gshadow</span>
<span style="color: #93a1a1;">/etc/ldap.conf</span>
<span style="color: #93a1a1;">/etc/nsswitch.conf</span>
<span style="color: #93a1a1;">/etc/openldap/ldap.conf</span>
<span style="color: #93a1a1;">/etc/pam.d/system-auth</span>
<span style="color: #93a1a1;">/etc/pam.d/system-auth-ac</span>
<span style="color: #93a1a1;">/etc/passwd</span>
<span style="color: #93a1a1;">/etc/passwd-</span>
<span style="color: #93a1a1;">/etc/shadow</span>
<span style="color: #93a1a1;">/etc/sysconfig/authconfig</span>
</pre>
</div>

<p>
Здесь в файлах <b>group</b>, <b>group-</b>, <b>gshadow</b>, <b>shadow</b>, <b>passwd-</b>,
<b>passwd</b> &#x2014; несущественные изменения, связанные с опцией
<b>enableshadow</b> и с добавлением ldap; <b>system-auth-ac</b> и
<b>system-auth</b> это один и тот же файл; файл <b>authconfig</b> просто
содержит все опции, указанные при конфигурировании.
</p>

<p>
Для конфигурации <b>6/2.4</b>, кроме файлов <b>nsswitch.conf</b>,
<b>/etc/openldap/ldap.conf</b> и <b>system-auth</b>, задействуются:
</p>

<ul class="org-ul">
<li><b>nslcd.conf</b> &#x2014; конфигурационный файл для службы сервиса имен LDAP.</li>
<li>Файлы, аналогичные <b>system-auth</b>. Они содержат только модули,
которые выполняют аутентификацию с соответствующим видом
аутентификационных токенов. Файлы <b>fingerprint-auth</b> и
<b>smartcard-auth</b> нас не интересуют, а содержимое <b>password-auth</b>
полностью идентично содержимому <b>system-auth</b>.</li>
<li><b>pam_ldap.conf</b> &#x2014; конфигурационный файл для <b>pam_ldap</b>.</li>
<li><b>sudo-ldap.conf</b> &#x2014; ldap-специфичная конфигурация для <b>sudo</b>. В
случае конфигурации <b>5/2.3</b> для этого использовался файл
<b>/etc/ldap.conf</b>.</li>
</ul>

<div class="org-src-container">
<label class="org-src-name">Список измененных файлов для <b>6/2.4</b></label>
<pre class="src src-diff"><span style="color: #93a1a1;">/etc/nslcd.conf</span>
<span style="color: #93a1a1;">/etc/nsswitch.conf</span>
<span style="color: #93a1a1;">/etc/openldap/cacerts</span>
<span style="color: #93a1a1;">/etc/openldap/ldap.conf</span>
<span style="color: #93a1a1;">/etc/pam.d/fingerprint-auth</span>
<span style="color: #93a1a1;">/etc/pam.d/fingerprint-auth-ac</span>
<span style="color: #93a1a1;">/etc/pam.d/password-auth</span>
<span style="color: #93a1a1;">/etc/pam.d/password-auth-ac</span>
<span style="color: #93a1a1;">/etc/pam.d/smartcard-auth</span>
<span style="color: #93a1a1;">/etc/pam.d/smartcard-auth-ac</span>
<span style="color: #93a1a1;">/etc/pam.d/system-auth</span>
<span style="color: #93a1a1;">/etc/pam.d/system-auth-ac</span>
<span style="color: #93a1a1;">/etc/pam_ldap.conf</span>
<span style="color: #93a1a1;">/etc/sudo-ldap.conf</span>
<span style="color: #93a1a1;">/etc/sysconfig/authconfig</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline17" class="outline-3">
<h3 id="client-options"><a id="orgheadline17"></a><a id="ID-a8dfad56-906c-45b6-9ef1-7d5a9cfa854f"></a><span class="section-number-3">2.4</span> Описание опций&nbsp;<sup><i class="fa fa-star"></i></sup></h3>
<div class="outline-text-3" id="text-client-options">
</div>

<div id="outline-container-orgheadline12" class="outline-4">
<h4 id="orgheadline12"><a id="ID-e8f37bcc-b065-41f2-9398-80816656d325"></a><span class="section-number-4">2.4.1</span> PAM: необходимые сведения</h4>
<div class="outline-text-4" id="text-2-4-1">
<p>
Утилита <b>authconfig</b> осуществляет необходимую модификацию <b>PAM</b>
(Pluggable Authentication Modules), добавляя библиотеку <b>pam_ldap.so</b>
и дополнительные настройки, обеспечивающие поддержку механизма
аутентификации средствами LDAP. PAM &#x2014; это стандартный интерфейс,
который может работать как с локальными базами данных <b>files</b>, так и c
базой <b>ldap</b>.
</p>

<p>
С точки зрения PAM, аутентификация состоит из нескольких независимых задач:
</p>
<ul class="org-ul">
<li><b>account</b> (управление учетными записями) &#x2014; описывает службу
проверки учетной записи, которая отвечает на вопросы: "есть ли
такая запись и не истек ли срок действия пароля?", "имеет ли
пользователь право доступа к запрошенному ресурсу?"</li>
<li><b>auth</b> (управление аутентификацией) &#x2014; описывает службу проверки
идентичности пользователя. Эта служба реализована посредством
диалога между пользователем и программой аутентификации: "как тебя
зовут и какой у тебя пароль?".</li>
<li><b>password</b> (управление паролями) &#x2014; описывает службу изменения
пароля; такая служба должна быть тесно связана со службой проверки
учетной записи. Например, по истечении срока действия пароля
система требует у пользователя новый пароль.</li>
<li><b>session</b> (управление сессиями) &#x2014; описывает работы, которые
должны быть выполнены до того, как ресурс будет предоставлен, или
после того, как он будет освобожден (например, после разрыва
соединения между программой-клиентом и вызванной им
службой-сервером). Скажем, это может быть протоколирование начала
и конца соединения, монтирование домашнего каталога пользователя и
т.п.</li>
</ul>

<p>
Поведение модулей аутентификации в стеке:
</p>
<ul class="org-ul">
<li><b>requisite</b> &#x2014; отказ приводит к немедленному прекращению аутентификации;</li>
<li><b>required</b> &#x2014; отказ приводит к тому, что PAM API возвращает ошибку,
но только после того, как будут вызваны все оставшиеся в стеке
модули (для этого приложения);</li>
<li><b>sufficient</b> &#x2014; успешная аутентификация достаточна для
удовлетворения требований по аутентификации стека модулей (если
предыдущий модуль в стеке выдал отказ в аутентификации, то успех
аутентификации текущего модуля игнорируется);</li>
<li><b>optional</b> &#x2014; успех или отказ в аутентификации с использованием
данного модуля имеет значение, только если это единственный модуль в
стеке, ассоциированном с данным приложением и типом аутентификации
(т.е. нет других <b>optional</b> модулей).</li>
</ul>
</div>
</div>

<div id="outline-container-orgheadline13" class="outline-4">
<h4 id="orgheadline13"><a id="ID-2cffdc55-f975-415c-a4df-0b8ba3dab1b7"></a><span class="section-number-4">2.4.2</span> Опции, связанные с conf-файлами для <b>5/2.3</b></h4>
<div class="outline-text-4" id="text-2-4-2">
<p>
<b>/etc/ldap.conf</b>. Параметр <b>host</b> не рекомендуется к использованию,
используется параметр <b>uri</b>, который указывает адрес LDAP сервера и
протокол, по которому осуществляется взаимодействие. Остальные
параметры понятны: SSL не используется, ожидается <b>md5</b> шифрование для
паролей в PAM.
</p>

<p>
<b>nsswitch.conf</b>. Для баз данных <b>passwd</b>, <b>shadow</b>, <b>group</b>,
<b>netgroup</b> и <b>automount</b> добавляется спецификация службы <b>ldap</b>.
</p>

<div class="org-src-container">
<label class="org-src-name">Опции, выставляемые в файлах для <b>5/2.3</b> (а)</label>
<pre class="src src-diff"><span style="color: #93a1a1;">/etc/ldap.conf</span>
<span style="background-color: #fdf6e3;">17c17</span>
<span style="color: #dc322f;">&lt;</span><span style="color: #dc322f;"> host 127.0.0.1</span>
<span style="background-color: #fdf6e3;">---</span>
<span style="color: #859900;">&gt;</span><span style="color: #859900;"> #host 127.0.0.1</span>
<span style="background-color: #fdf6e3;">20c20</span>
<span style="color: #dc322f;">&lt;</span><span style="color: #dc322f;"> base dc=example,dc=com</span>
<span style="background-color: #fdf6e3;">---</span>
<span style="color: #859900;">&gt;</span><span style="color: #859900;"> base dc=mercury,dc=febras,dc=net</span>
<span style="background-color: #fdf6e3;">295a296,303</span>
<span style="color: #859900;">&gt;</span><span style="color: #859900;"> uri ldap://172.17.0.4/</span>
<span style="color: #859900;">&gt;</span><span style="color: #859900;"> ssl no</span>
<span style="color: #859900;">&gt;</span><span style="color: #859900;"> tls_cacertdir /etc/openldap/cacerts</span>
<span style="color: #859900;">&gt;</span><span style="color: #859900;"> pam_password md5</span>
<span style="color: #859900;">&gt;</span><span style="color: #859900;"> sudoers_base dc=mercury,dc=febras,dc=net</span>
<span style="color: #859900;">&gt;</span><span style="color: #859900;"> sudoers_debug 0</span>
<span style="color: #859900;">&gt;</span><span style="color: #859900;"> binddn cn=authenticator,dc=mercury,dc=febras,dc=net</span>
<span style="color: #859900;">&gt;</span><span style="color: #859900;"> bindpw secret</span>
<span style="color: #93a1a1;">/etc/nsswitch.conf</span>
<span style="background-color: #fdf6e3;">33,35c33,35</span>
<span style="color: #dc322f;">&lt;</span><span style="color: #dc322f;"> passwd:     files</span>
<span style="color: #dc322f;">&lt;</span><span style="color: #dc322f;"> shadow:     files</span>
<span style="color: #dc322f;">&lt;</span><span style="color: #dc322f;"> group:      files</span>
<span style="background-color: #fdf6e3;">---</span>
<span style="color: #859900;">&gt;</span><span style="color: #859900;"> passwd:     files ldap</span>
<span style="color: #859900;">&gt;</span><span style="color: #859900;"> shadow:     files ldap</span>
<span style="color: #859900;">&gt;</span><span style="color: #859900;"> group:      files ldap</span>
<span style="background-color: #fdf6e3;">57c57</span>
<span style="color: #dc322f;">&lt;</span><span style="color: #dc322f;"> netgroup:   nisplus</span>
<span style="background-color: #fdf6e3;">---</span>
<span style="color: #859900;">&gt;</span><span style="color: #859900;"> netgroup:   files ldap</span>
<span style="background-color: #fdf6e3;">61c61</span>
<span style="color: #dc322f;">&lt;</span><span style="color: #dc322f;"> automount:  files nisplus</span>
<span style="background-color: #fdf6e3;">---</span>
<span style="color: #859900;">&gt;</span><span style="color: #859900;"> automount:  files ldap</span>
<span style="color: #93a1a1;">/etc/openldap/ldap.conf</span>
<span style="background-color: #fdf6e3;">13a14,16</span>
<span style="color: #859900;">&gt;</span><span style="color: #859900;"> URI ldap://172.17.0.4/</span>
<span style="color: #859900;">&gt;</span><span style="color: #859900;"> BASE dc=mercury,dc=febras,dc=net</span>
<span style="color: #859900;">&gt;</span><span style="color: #859900;"> TLS_CACERTDIR /etc/openldap/cacerts</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline14" class="outline-4">
<h4 id="orgheadline14"><a id="ID-0c82d86b-ddc5-43c1-b4ea-a58af035d923"></a><span class="section-number-4">2.4.3</span> Опции, связанные с system-auth для <b>5/2.3</b></h4>
<div class="outline-text-4" id="text-2-4-3">
<p>
<b>system-auth</b>. Наибольшее количество изменений вносится в этот файл.
</p>
<ul class="org-ul">
<li><b>auth</b>
<ul class="org-ul">
<li>sufficient <b>pam_unix.so</b>: порядок опций не важен. Без изменения.</li>
<li>requisite <b>pam_succeed_if.so</b>: проверяет характеристику <b>uid</b> аккаунта, не
записывая ничего в системный log-файл</li>
<li>sufficient <b>pam_ldap.so</b>: pam_ldap должен всегда использовать
первый пароль, доступный в аутентификационном стеке</li>
</ul></li>
<li><b>account</b>
<ul class="org-ul">
<li>required <b>pam_unix.so</b>: игнорируются ошибки чтения shadow информации</li>
<li>sufficient <b>pam_succeed_if.so</b>:</li>
</ul></li>
</ul>
<div class="org-src-container">
<label class="org-src-name">Опции, выставляемые в файлах для <b>5/2.3</b> (б)</label>
<pre class="src src-diff"><span style="color: #93a1a1;">/etc/pam.d/system-auth</span>
<span style="background-color: #fdf6e3;">5c5,7</span>
<span style="color: #dc322f;">&lt;</span><span style="color: #dc322f;"> auth        sufficient    pam_unix.so try_first_pass nullok</span>
<span style="background-color: #fdf6e3;">---</span>
<span style="color: #859900;">&gt;</span><span style="color: #859900;"> auth        sufficient    pam_unix.so nullok try_first_pass</span>
<span style="color: #859900;">&gt;</span><span style="color: #859900;"> auth        requisite     pam_succeed_if.so uid &gt;= 500 quiet</span>
<span style="color: #859900;">&gt;</span><span style="color: #859900;"> auth        sufficient    pam_ldap.so use_first_pass</span>
<span style="background-color: #fdf6e3;">8c10,13</span>
<span style="color: #dc322f;">&lt;</span><span style="color: #dc322f;"> account     required      pam_unix.so</span>
<span style="background-color: #fdf6e3;">---</span>
<span style="color: #859900;">&gt;</span><span style="color: #859900;"> account     required      pam_unix.so broken_shadow</span>
<span style="color: #859900;">&gt;</span><span style="color: #859900;"> account     sufficient    pam_succeed_if.so uid &lt; 500 quiet</span>
<span style="color: #859900;">&gt;</span><span style="color: #859900;"> account     [default=bad success=ok user_unknown=ignore] pam_ldap.so</span>
<span style="color: #859900;">&gt;</span><span style="color: #859900;"> account     required      pam_permit.so</span>
<span style="background-color: #fdf6e3;">10,11c15,17</span>
<span style="color: #dc322f;">&lt;</span><span style="color: #dc322f;"> password    required      pam_cracklib.so try_first_pass retry=3</span>
<span style="color: #dc322f;">&lt;</span><span style="color: #dc322f;"> password    sufficient    pam_unix.so try_first_pass use_authtok nullok md5</span>
<span style="background-color: #fdf6e3;">---</span>
<span style="color: #859900;">&gt;</span><span style="color: #859900;"> password    requisite     pam_cracklib.so try_first_pass retry=3</span>
<span style="color: #859900;">&gt;</span><span style="color: #859900;"> password    sufficient    pam_unix.so md5 shadow nullok try_first_pass use_authtok</span>
<span style="color: #859900;">&gt;</span><span style="color: #859900;"> password    sufficient    pam_ldap.so use_authtok</span>
<span style="background-color: #fdf6e3;">15a22</span>
<span style="color: #859900;">&gt;</span><span style="color: #859900;"> session     optional      pam_mkhomedir.so</span>
<span style="background-color: #fdf6e3;">17a25</span>
<span style="color: #859900;">&gt;</span><span style="color: #859900;"> session     optional      pam_ldap.so</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline15" class="outline-4">
<h4 id="orgheadline15"><a id="ID-bffd7a17-e40c-4550-92d4-2d4ece369ca3"></a><span class="section-number-4">2.4.4</span> Опции, связанные с conf-файлами для <b>6/2.4</b></h4>
<div class="outline-text-4" id="text-2-4-4">
<p>
В файлах <b>nslcd.conf</b>, <b>pam_ldap.conf</b> и <b>sudo-ldap.conf</b> дублируются
стандартные опции.
</p>

<div class="org-src-container">
<label class="org-src-name">Опции, выставляемые в файлах для <b>6/2.4</b> (а)</label>
<pre class="src src-diff"><span style="color: #93a1a1;">/etc/nslcd.conf</span>
<span style="background-color: #fdf6e3;">131,132c131,136</span>
<span style="color: #dc322f;">&lt;</span><span style="color: #dc322f;"> uri ldap://127.0.0.1/</span>
<span style="color: #dc322f;">&lt;</span><span style="color: #dc322f;"> base dc=example,dc=com</span>
<span style="background-color: #fdf6e3;">---</span>
<span style="color: #859900;">&gt;</span><span style="color: #859900;"> uri ldap://172.17.0.2/</span>
<span style="color: #859900;">&gt;</span><span style="color: #859900;"> base dc=mercury,dc=febras,dc=net</span>
<span style="color: #859900;">&gt;</span><span style="color: #859900;"> ssl no</span>
<span style="color: #859900;">&gt;</span><span style="color: #859900;"> tls_cacertdir /etc/openldap/cacerts</span>
<span style="color: #859900;">&gt;</span><span style="color: #859900;"> binddn cn=authenticator,dc=mercury,dc=febras,dc=net</span>
<span style="color: #859900;">&gt;</span><span style="color: #859900;"> bindpw secret</span>
<span style="color: #93a1a1;">/etc/nsswitch.conf</span>
<span style="background-color: #fdf6e3;">33,35c33,35</span>
<span style="color: #dc322f;">&lt;</span><span style="color: #dc322f;"> passwd:     files</span>
<span style="color: #dc322f;">&lt;</span><span style="color: #dc322f;"> shadow:     files</span>
<span style="color: #dc322f;">&lt;</span><span style="color: #dc322f;"> group:      files</span>
<span style="background-color: #fdf6e3;">---</span>
<span style="color: #859900;">&gt;</span><span style="color: #859900;"> passwd:     files ldap</span>
<span style="color: #859900;">&gt;</span><span style="color: #859900;"> shadow:     files ldap</span>
<span style="color: #859900;">&gt;</span><span style="color: #859900;"> group:      files ldap</span>
<span style="background-color: #fdf6e3;">57c57</span>
<span style="color: #dc322f;">&lt;</span><span style="color: #dc322f;"> netgroup:   nisplus</span>
<span style="background-color: #fdf6e3;">---</span>
<span style="color: #859900;">&gt;</span><span style="color: #859900;"> netgroup:   files ldap</span>
<span style="background-color: #fdf6e3;">61c61</span>
<span style="color: #dc322f;">&lt;</span><span style="color: #dc322f;"> automount:  files nisplus</span>
<span style="background-color: #fdf6e3;">---</span>
<span style="color: #859900;">&gt;</span><span style="color: #859900;"> automount:  files ldap</span>
<span style="background-color: #fdf6e3;">63a64</span>
<span style="color: #859900;">&gt;</span><span style="color: #859900;"> sudoers: files ldap</span>
<span style="color: #93a1a1;">/etc/openldap/ldap.conf</span>
<span style="background-color: #fdf6e3;">15c15,17</span>
<span style="color: #dc322f;">&lt;</span><span style="color: #dc322f;"> TLS_CACERTDIR /etc/openldap/certs</span>
<span style="background-color: #fdf6e3;">---</span>
<span style="color: #859900;">&gt;</span><span style="color: #859900;"> TLS_CACERTDIR /etc/openldap/cacerts</span>
<span style="color: #859900;">&gt;</span><span style="color: #859900;"> URI ldap://172.17.0.2/</span>
<span style="color: #859900;">&gt;</span><span style="color: #859900;"> BASE dc=mercury,dc=febras,dc=net</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline16" class="outline-4">
<h4 id="orgheadline16"><a id="ID-5bedb39f-f4fd-416b-9c11-ebba1119ac1a"></a><span class="section-number-4">2.4.5</span> Опции, связанные с system-auth для <b>6/2.4</b></h4>
<div class="outline-text-4" id="text-2-4-5">
<div class="org-src-container">
<label class="org-src-name">Опции, выставляемые в файлах для <b>6/2.4</b> (б)</label>
<pre class="src src-diff"><span style="color: #93a1a1;">/etc/pam.d/system-auth</span>
<span style="background-color: #fdf6e3;">5c5,7</span>
<span style="color: #dc322f;">&lt;</span><span style="color: #dc322f;"> auth        sufficient    pam_unix.so try_first_pass nullok</span>
<span style="background-color: #fdf6e3;">---</span>
<span style="color: #859900;">&gt;</span><span style="color: #859900;"> auth        sufficient    pam_unix.so nullok try_first_pass</span>
<span style="color: #859900;">&gt;</span><span style="color: #859900;"> auth        requisite     pam_succeed_if.so uid &gt;= 500 quiet</span>
<span style="color: #859900;">&gt;</span><span style="color: #859900;"> auth        sufficient    pam_ldap.so use_first_pass</span>
<span style="background-color: #fdf6e3;">8c10,14</span>
<span style="color: #dc322f;">&lt;</span><span style="color: #dc322f;"> account     required      pam_unix.so</span>
<span style="background-color: #fdf6e3;">---</span>
<span style="color: #859900;">&gt;</span><span style="color: #859900;"> account     required      pam_unix.so broken_shadow</span>
<span style="color: #859900;">&gt;</span><span style="color: #859900;"> account     sufficient    pam_localuser.so</span>
<span style="color: #859900;">&gt;</span><span style="color: #859900;"> account     sufficient    pam_succeed_if.so uid &lt; 500 quiet</span>
<span style="color: #859900;">&gt;</span><span style="color: #859900;"> account     [default=bad success=ok user_unknown=ignore] pam_ldap.so</span>
<span style="color: #859900;">&gt;</span><span style="color: #859900;"> account     required      pam_permit.so</span>
<span style="background-color: #fdf6e3;">11c17,18</span>
<span style="color: #dc322f;">&lt;</span><span style="color: #dc322f;"> password    sufficient    pam_unix.so try_first_pass use_authtok nullok sha512 shadow</span>
<span style="background-color: #fdf6e3;">---</span>
<span style="color: #859900;">&gt;</span><span style="color: #859900;"> password    sufficient    pam_unix.so sha512 shadow nullok try_first_pass use_authtok</span>
<span style="color: #859900;">&gt;</span><span style="color: #859900;"> password    sufficient    pam_ldap.so use_authtok</span>
<span style="background-color: #fdf6e3;">15a23</span>
<span style="color: #859900;">&gt;</span><span style="color: #859900;"> session     optional      pam_mkhomedir.so umask=0077</span>
<span style="background-color: #fdf6e3;">17a26</span>
<span style="color: #859900;">&gt;</span><span style="color: #859900;"> session     optional      pam_ldap.so</span>
<span style="color: #93a1a1;">/etc/pam_ldap.conf</span>
<span style="background-color: #fdf6e3;">17c17</span>
<span style="color: #dc322f;">&lt;</span><span style="color: #dc322f;"> host 127.0.0.1</span>
<span style="background-color: #fdf6e3;">---</span>
<span style="color: #859900;">&gt;</span><span style="color: #859900;"> #host 127.0.0.1</span>
<span style="background-color: #fdf6e3;">20c20</span>
<span style="color: #dc322f;">&lt;</span><span style="color: #dc322f;"> base dc=example,dc=com</span>
<span style="background-color: #fdf6e3;">---</span>
<span style="color: #859900;">&gt;</span><span style="color: #859900;"> base dc=mercury,dc=febras,dc=net</span>
<span style="background-color: #fdf6e3;">289a290,295</span>
<span style="color: #859900;">&gt;</span><span style="color: #859900;"> uri ldap://172.17.0.2/</span>
<span style="color: #859900;">&gt;</span><span style="color: #859900;"> ssl no</span>
<span style="color: #859900;">&gt;</span><span style="color: #859900;"> tls_cacertdir /etc/openldap/cacerts</span>
<span style="color: #859900;">&gt;</span><span style="color: #859900;"> pam_password md5</span>
<span style="color: #859900;">&gt;</span><span style="color: #859900;"> binddn cn=authenticator,dc=mercury,dc=febras,dc=net</span>
<span style="color: #859900;">&gt;</span><span style="color: #859900;"> bindpw secret</span>
<span style="color: #93a1a1;">/etc/sudo-ldap.conf</span>
<span style="background-color: #fdf6e3;">86a87,92</span>
<span style="color: #859900;">&gt;</span><span style="color: #859900;"> uri ldap://172.17.0.2/</span>
<span style="color: #859900;">&gt;</span><span style="color: #859900;"> base dc=mercury,dc=febras,dc=net</span>
<span style="color: #859900;">&gt;</span><span style="color: #859900;"> sudoers_base dc=mercury,dc=febras,dc=net</span>
<span style="color: #859900;">&gt;</span><span style="color: #859900;"> sudoers_debug 0</span>
<span style="color: #859900;">&gt;</span><span style="color: #859900;"> binddn cn=authenticator,dc=mercury,dc=febras,dc=net</span>
<span style="color: #859900;">&gt;</span><span style="color: #859900;"> bindpw secret</span>
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-orgheadline21" class="outline-2">
<h2 id="schema"><a id="orgheadline21"></a><a id="ID-b64d7c36-b2b3-49ac-9620-d7c94eb9ea31"></a><span class="section-number-2">3</span> Схема БД LDAP</h2>
<div class="outline-text-2" id="text-schema">
<blockquote>
<p>
Необходимо разработать схему БД LDAP, предназначенную для хранения учетных данных пользователей кластера.
</p>
</blockquote>

<p>
Использование только <b>ldif</b> формата позволяет единообразно
конфигурировать схему <b>LDAP</b>, начиная с корневой записи DIT (Directory
Information Tree) <b>cn=config</b> и заканчивая листьями этого дерева &#x2014;
записями, содержащими нужную информацию:
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left"><b>slapd.ldif</b></td>
<td class="org-left">формирование корневой записи DIT и контейнера для наборов схем данных; конфигурирование базы данных <b>hdb</b> и подключение мониторинга баз данных</td>
</tr>

<tr>
<td class="org-left"><b>front.ldif</b></td>
<td class="org-left">добавление служебной базы данных <b>frontend</b> (только для <b>5/2.3</b>)</td>
</tr>

<tr>
<td class="org-left"><b>domain.ldif</b></td>
<td class="org-left">установка суффикса, менеджера базы <b>hdb</b> и его пароля, и ACL для базы <b>hdb</b></td>
</tr>

<tr>
<td class="org-left"><b>base.ldif</b></td>
<td class="org-left">настройка корневого суффикса, менеджера, организационных единиц и пользователя <b>authenticator</b></td>
</tr>

<tr>
<td class="org-left"><b>sudo.ldif</b></td>
<td class="org-left">настройка организационной единицы <b>sudoers</b>, добавление группы <b>wheel</b></td>
</tr>

<tr>
<td class="org-left"><b>user.ldif</b></td>
<td class="org-left">создание нового пользователя</td>
</tr>
</tbody>
</table>

<p>
Если же используется <b>conf</b> формат, то надо иметь в виду, что
просто стартовая часть этого стройного ряда
конфигурационных файлов заменяется на <b>slapd.conf</b>.
</p>
</div>

<div id="outline-container-orgheadline19" class="outline-3">
<h3 id="ldap-possibilities"><a id="orgheadline19"></a><a id="ID-4f9ddacc-3908-4cd1-b091-3f00c31aa8a7"></a><span class="section-number-3">3.1</span> Возможности LDAP</h3>
<div class="outline-text-3" id="text-ldap-possibilities">
<p>
Возможности протокола LDAP значительно определяются схемами, которые можно подключить с помощью директивы <b>include</b>. Помня об основной цели, рассмотрим типичные задачи, которые можно решить с их помощью. В первую очередь нас интересуют уже готовые схемы, входящие в дистрибутив <b>OpenLDAP</b> или разработанные сторонними поставщиками.
</p>

<ul class="org-ul">
<li><a href="http://pro-ldap.ru/books/openldap-ubuntu-in-practice/index.html">OpenLDAP и Ubuntu на практике</a>
<ul class="org-ul">
<li>Управление пользователями и группами в <b>OpenLDAP</b></li>
<li>Настройка аутентификации пользователей через <b>OpenLDAP</b> на клиенте</li>
<li>Настройка <b>OpenLDAP</b> в качестве хранилища правил <b>sudo</b> (sudo.schema)</li>
<li><b>OpenLDAP</b> как хранилище карт автоматического монтирования для <b>autofs</b> (autofs.schema)</li>
<li>Репозиторий <b>NFS netgroup</b> на основе <b>OpenLDAP</b> для <b>autofs</b> (расширение возможностей стандартной схемы nis.schema)</li>
</ul></li>

<li><a href="https://www.fusiondirectory.org/user_management/">FusionDirectory</a>
<ul class="org-ul">
<li>Управление пользователями
<ul class="org-ul">
<li>Управление квотами пользователей</li>
<li>Управление <b>ssh</b> ключами, сертификатами пользователей</li>
<li>Управление учетными записями сервисов почты, <b>Samba</b>, <b>Nagios</b>,
<b>Squid</b> и т.д.</li>
</ul></li>
<li>Управление системами
<ul class="org-ul">
<li>Тонкие клиенты, десктопы, серверы, voip, сетевые и мобильные
устройства</li>
</ul></li>
<li>Управление сервисами
<ul class="org-ul">
<li>Управление сервисами <b>DHCP</b>, <b>DNS</b>, <b>Web management interface</b></li>
<li>Управление репозиториями</li>
</ul></li>
</ul></li>
</ul>
</div>
</div>

<div id="outline-container-orgheadline20" class="outline-3">
<h3 id="minimal-schema"><a id="orgheadline20"></a><a id="ID-3446a07c-3649-4e85-84c1-044e78c340dc"></a><span class="section-number-3">3.2</span> Подготовка к тестированию аутентификации при помощи LDAP</h3>
<div class="outline-text-3" id="text-minimal-schema">
<p>
Чтобы получить минимально работоспособный сервер LDAP, позволяющий
осуществлять аутентификацию для клиентских систем, внесем необходимые
изменения в схему. В частности, сконфигурируем (см. расп. <a href="#orgsrcblock3">27</a>)
базу <b>hdb</b> для доменного имени <b>dc=mercury,dc=febras,dc=net</b>,
определим менеджера домена <b>cn=Manager,dc=mercury,dc=febras,dc=net</b> и
его пароль. Также, добавим в <b>domain.ldif</b> правила доступа к атрибутам
<b>userPassword</b>, <b>shadowLastChange</b> и <b>loginShell</b>: для владельца
записи &#x2014; write и для неавторизованного пользователя &#x2014; auth.
Анонимный доступ будет разрешен только для подразделения
<b>people</b>. Используем учетную запись <b>authenticator</b> для ограничения
доступа к остальным атрибутам.
</p>

<div class="org-src-container">

<pre class="src src-sh"><span style="color: #657b83; font-weight: bold;">cd</span> /schema

cp domain.ldif domain+.ldif
<span style="color: #268bd2;">MANAGER_PWD</span>=$(<span style="color: #6c71c4; font-weight: bold;">slappasswd</span> -s $<span style="color: #268bd2;">LDAP_MANAGER_PASSWORD</span>)
<span style="color: #93a1a1;"># </span><span style="color: #93a1a1;">Use bash variable substitution to escape special chars http://stackoverflow.com/a/14339705</span>
sed -i <span style="color: #2aa198;">"s+%LDAP_MANAGER_PASSWORD%+${MANAGER_PWD//+/\\+}+"</span> domain+.ldif
ldapmodify -v -D <span style="color: #268bd2;">cn</span>=Manager,<span style="color: #268bd2;">cn</span>=config -f domain+.ldif -x -w $<span style="color: #268bd2;">LDAP_ROOT_PASSWORD</span>
rm domain+.ldif
ldapadd -x -D <span style="color: #2aa198;">'cn=Manager,dc=mercury,dc=febras,dc=net'</span> -w $<span style="color: #268bd2;">LDAP_MANAGER_PASSWORD</span> -f base.ldif
ldapadd -x -D <span style="color: #2aa198;">'cn=Manager,dc=mercury,dc=febras,dc=net'</span> -w $<span style="color: #268bd2;">LDAP_MANAGER_PASSWORD</span> -f sudo.ldif
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><b>domain.ldif</b>: установка суффикса, менеджера базы <b>hdb</b> и его пароля, и ACL для базы <b>hdb</b></label>
<pre class="src src-ldif" id="orgsrcblock3"><span style="color: #859900; font-weight: bold;">dn</span>: <span style="color: #268bd2;">olcDatabase={2}hdb,cn=config</span>
<span style="color: #859900; font-weight: bold;">changetype</span>: <span style="color: #268bd2; font-weight: bold;">modify</span>
<span style="color: #859900; font-weight: bold;">replace</span>: <span style="color: #268bd2;">olcSuffix</span>
olcSuffix: dc=mercury,dc=febras,dc=net

<span style="color: #859900; font-weight: bold;">dn</span>: <span style="color: #268bd2;">olcDatabase={2}hdb,cn=config</span>
<span style="color: #859900; font-weight: bold;">changetype</span>: <span style="color: #268bd2; font-weight: bold;">modify</span>
<span style="color: #859900; font-weight: bold;">replace</span>: <span style="color: #268bd2;">olcRootDN</span>
olcRootDN: cn=Manager,dc=mercury,dc=febras,dc=net

<span style="color: #859900; font-weight: bold;">dn</span>: <span style="color: #268bd2;">olcDatabase={2}hdb,cn=config</span>
<span style="color: #859900; font-weight: bold;">changetype</span>: <span style="color: #268bd2; font-weight: bold;">modify</span>
<span style="color: #859900; font-weight: bold;">add</span>: <span style="color: #268bd2;">olcRootPW</span>
olcRootPW: %LDAP_MANAGER_PASSWORD%

<span style="color: #859900; font-weight: bold;">dn</span>: <span style="color: #268bd2;">olcDatabase={2}hdb,cn=config</span>
<span style="color: #859900; font-weight: bold;">add</span>: <span style="color: #268bd2;">olcAccess</span>
olcAccess: {0}to attrs=userPassword,shadowLastChange,loginShell
  by anonymous auth
  by self write
  by * none
olcAccess: {1}to dn.base="ou=people,dc=mercury,dc=febras,dc=net"
  by * read
olcAccess: {2}to *
  by dn="cn=authenticator,dc=mercury,dc=febras,dc=net" read
  by * none
</pre>
</div>

<p>
Далее, пропишем (см. расп. <a href="#orgsrcblock4">28</a>) необходимые атрибуты, начиная с
корневого узла <b>dn: dc=mercury,dc=febras,dc=net</b>, добавим
подразделения <b>people</b> и <b>groups</b>, а также пользователя
<b>authenticator</b>. Создадим подразделение <b>sudoers</b>, одну posix-группу
<b>wheel</b> и сконфигурируем <b>sudoers</b> так, чтобы разрешить выполнение
<b>sudo</b> команд без ввода пароля для членов этой группы
(см. расп. <a href="#orgsrcblock5">29</a>).
</p>

<div class="org-src-container">
<label class="org-src-name"><b>base.ldif</b>: настройка корневого суффикса, менеджера, организационных единиц и пользователя <b>authenticator</b></label>
<pre class="src src-ldif" id="orgsrcblock4"><span style="color: #859900; font-weight: bold;">dn</span>: <span style="color: #268bd2;">dc=mercury,dc=febras,dc=net</span>
objectClass: top
objectClass: dcObject
objectClass: organization
dc: mercury
o: mercury

<span style="color: #859900; font-weight: bold;">dn</span>: <span style="color: #268bd2;">cn=Manager,dc=mercury,dc=febras,dc=net</span>
objectClass: organizationalRole
cn: Manager
description: Directory Manager

<span style="color: #859900; font-weight: bold;">dn</span>: <span style="color: #268bd2;">ou=people,dc=mercury,dc=febras,dc=net</span>
objectClass: organizationalUnit
ou: people

<span style="color: #859900; font-weight: bold;">dn</span>: <span style="color: #268bd2;">ou=groups,dc=mercury,dc=febras,dc=net</span>
objectClass: organizationalUnit
ou: groups

<span style="color: #859900; font-weight: bold;">dn</span>: <span style="color: #268bd2;">cn=authenticator,dc=mercury,dc=febras,dc=net</span>
objectClass: person
cn: authenticator
sn: authenticator
description: Used for authentication to LDAP
userPassword: secret
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><b>sudo.ldif</b>: настройка организационной единицы <b>sudoers</b>, добавление группы <b>wheel</b></label>
<pre class="src src-ldif" id="orgsrcblock5"><span style="color: #859900; font-weight: bold;">dn</span>: <span style="color: #268bd2;">ou=sudoers,dc=mercury,dc=febras,dc=net</span>
objectClass: organizationalUnit
ou: sudoers

<span style="color: #859900; font-weight: bold;">dn</span>: <span style="color: #268bd2;">cn=wheel,ou=groups,dc=mercury,dc=febras,dc=net</span>
cn: wheel
objectClass: posixGroup
objectClass: top
gidNumber: 1030

<span style="color: #859900; font-weight: bold;">dn</span>: <span style="color: #268bd2;">cn=admins,ou=sudoers,dc=mercury,dc=febras,dc=net</span>
objectClass: sudoRole
objectClass: top
cn: admins
sudoCommand: ALL
sudoRunAs: ALL
sudoHost: ALL
sudoUser: %wheel
sudoOption: !authenticate

<span style="color: #859900; font-weight: bold;">dn</span>: <span style="color: #268bd2;">cn=defaults,ou=sudoers,dc=mercury,dc=febras,dc=net</span>
objectClass: sudoRole
objectClass: top
cn: defaults
sudoOption: ignore_local_sudoers
sudoOption: env_reset
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgheadline27" class="outline-2">
<h2 id="new-user"><a id="orgheadline27"></a><a id="ID-6fe3c37d-639a-4656-9675-bdc7a6c5ddb2"></a><span class="section-number-2">4</span> Процесс добавления нового пользователя в систему</h2>
<div class="outline-text-2" id="text-new-user">
<blockquote>
<p>
Необходимо разработать документацию по процессу добавления нового
пользователя в систему, использующего аутентификацию посредством
LDAP. Предложить CLI (или GUI WEB) интерфейс для выполнения данной
операции. Ориентироваться на использование в ОС <b>CentOS 5/6</b>.
</p>
</blockquote>
</div>

<div id="outline-container-orgheadline22" class="outline-3">
<h3 id="new-user-ldap"><a id="orgheadline22"></a><a id="ID-6e8437bc-7e1f-489a-9afb-44f3d67d49ab"></a><span class="section-number-3">4.1</span> Добавление пользователя с помощью CLI интерфейса</h3>
<div class="outline-text-3" id="text-new-user-ldap">
<p>
Используем утилиту <b>ldapadd</b> для добавления записи пользователя в формате <b>ldif</b>
</p>

<div class="org-src-container">

<pre class="src src-sh">ldapadd -x -D <span style="color: #2aa198;">'cn=Manager,dc=mercury,dc=febras,dc=net'</span> -w $<span style="color: #268bd2;">LDAP_MANAGER_PASSWORD</span> -f user.ldif
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><b>user.ldif</b>: создание нового пользователя</label>
<pre class="src src-ldif"><span style="color: #859900; font-weight: bold;">dn</span>: <span style="color: #268bd2;">uid=username,ou=people,dc=mercury,dc=febras,dc=net</span>
cn: User Name
userPassword: p@ssw0rd
uid: username
uidNumber: 1050
loginShell: /bin/bash
homeDirectory: /home/webminder
gidNumber: 1030
objectClass: posixAccount
objectClass: shadowAccount
objectClass: person
objectClass: inetOrgPerson
gecos: User Name
sn: User Name
shadowLastChange: 17093
shadowMin: 0
shadowMax: 99999
shadowWarning: 7
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline23" class="outline-3">
<h3 id="new-user-php"><a id="orgheadline23"></a><a id="ID-6de9e6dc-04f2-429d-b22e-55caa2e270ee"></a><span class="section-number-3">4.2</span> Добавление пользователя с помощью GUI Web интерфейса</h3>
<div class="outline-text-3" id="text-new-user-php">
<p>
Как мы видели, добавление записи в БД LDAP с помощью <b>ldif</b>-файла
сопровождается некоторым дублированием информации и мелкими
неудобствами. Например, приходится дублировать часть уникального имени
<b>dn</b>, хотя при использовании более развитых средств, эта часть могла
быть получена из контекста автоматически. С другой стороны, такая
форма записи "говорит сама за себя": уникальное имя полностью
определяет место объекта в БД, являясь одновременно как описательной
(по аналогии с <b>SQL Data Definition Language</b>) &#x2014; при использовании
<b>ldapsearch</b>, так и модфицирующей (<b>SQL Data Manipulation Language</b>)
конструкцией &#x2014; в случае использования утилит <b>ldapadd/slapadd</b> или
<b>ldapmodify/slapmodify</b>.
</p>

<p>
Далее, приходится дублировать одинаковые для всех записей пользователя
поля <b>objectClass</b>, но с этим вполне можно смириться, поскольку обычно
используется готовый шаблон <b>ldif</b>-файла и уже в него вносятся
изменения. Чуть большее неудобство таит в себе поле <b>gidNumber</b>,
поскольку приходится узнавать и прописывать номер группы. Впрочем, при
небольшом количестве групп, а тем более при наличии одной группы, это
не является проблемой.
</p>

<p>
В случае гибкой работы с настройками <b>shadow</b> полей, такой текстовый
интерфейс начнет приносить ощутимые проблемы, т.к., например, для
полей <b>shadowLastChange</b> и <b>shadowMax</b> необходимо вычислять количество
дней &#x2014; а это уже явно требует автоматизации.
</p>

<p>
Поле <b>userPassword</b> также требует аккуратного обращения: необходимо
каким то образом применять шифрование пароля с помощью утилит
<b>ldappasswd</b> или <b>slappasswd</b>.
</p>

<p>
Эти и другие проблемы призван решить GUI интерфейс, который позволяет
с помощью доступных шаблонов и средств описания GUI, реализовывать
нужную функциональность, в некоторых случаях значительно облегчая
работу со схемой БД LDAP.
</p>
<div align="right">
<a onclick="toggleDiv2('shadow',$(this));" class="fa fa-caret-right">custom-ShadowAccount.xml</a>
</div>
<div id="shadow" style="display:none">
<div class="org-src-container">
<label class="org-src-name">xml-файл шаблона <b>User Account With Shadow</b> браузера схемы</label>
<pre class="src src-xml">&lt;?<span style="color: #859900; font-weight: bold;">xml</span> <span style="color: #268bd2;">version</span>=<span style="color: #2aa198;">"</span><span style="color: #2aa198;">1.0</span><span style="color: #2aa198;">"</span> <span style="color: #268bd2;">encoding</span>=<span style="color: #2aa198;">"</span><span style="color: #2aa198;">UTF-8</span><span style="color: #2aa198;">"</span> <span style="color: #268bd2;">standalone</span>=<span style="color: #2aa198;">"</span><span style="color: #2aa198;">no</span><span style="color: #2aa198;">"</span>?&gt;
&lt;!<span style="color: #859900; font-weight: bold;">DOCTYPE</span> template <span style="color: #859900; font-weight: bold;">SYSTEM</span> <span style="color: #2aa198;">"</span><span style="color: #2aa198;">../template.dtd</span><span style="color: #2aa198;">"</span>&gt;

&lt;<span style="color: #268bd2;">template</span>&gt;
&lt;<span style="color: #268bd2;">askcontainer</span>&gt;1&lt;/<span style="color: #268bd2;">askcontainer</span>&gt;
&lt;<span style="color: #268bd2;">description</span>&gt;New User Account&lt;/<span style="color: #268bd2;">description</span>&gt;
&lt;<span style="color: #268bd2;">icon</span>&gt;ldap-user.png&lt;/<span style="color: #268bd2;">icon</span>&gt;
&lt;<span style="color: #268bd2;">invalid</span>&gt;0&lt;/<span style="color: #268bd2;">invalid</span>&gt;
&lt;<span style="color: #268bd2;">rdn</span>&gt;cn&lt;/<span style="color: #268bd2;">rdn</span>&gt;
<span style="color: #93a1a1;">&lt;!--</span><span style="color: #93a1a1;">&lt;regexp&gt;^ou=People,o=.*,&lt;/regexp&gt;</span><span style="color: #93a1a1;">--&gt;</span>
&lt;<span style="color: #268bd2;">title</span>&gt;Generic: User Account with Shadow&lt;/<span style="color: #268bd2;">title</span>&gt;
&lt;<span style="color: #268bd2;">visible</span>&gt;1&lt;/<span style="color: #268bd2;">visible</span>&gt;

&lt;<span style="color: #268bd2;">objectClasses</span>&gt;
&lt;<span style="color: #268bd2;">objectClass</span> <span style="color: #268bd2;">id</span>=<span style="color: #2aa198;">"</span><span style="color: #2aa198;">inetOrgPerson</span><span style="color: #2aa198;">"</span>&gt;&lt;/<span style="color: #268bd2;">objectClass</span>&gt;
&lt;<span style="color: #268bd2;">objectClass</span> <span style="color: #268bd2;">id</span>=<span style="color: #2aa198;">"</span><span style="color: #2aa198;">posixAccount</span><span style="color: #2aa198;">"</span>&gt;&lt;/<span style="color: #268bd2;">objectClass</span>&gt;
&lt;<span style="color: #268bd2;">objectClass</span> <span style="color: #268bd2;">id</span>=<span style="color: #2aa198;">"</span><span style="color: #2aa198;">shadowAccount</span><span style="color: #2aa198;">"</span>&gt;&lt;/<span style="color: #268bd2;">objectClass</span>&gt;
&lt;/<span style="color: #268bd2;">objectClasses</span>&gt;

&lt;<span style="color: #268bd2;">attributes</span>&gt;
&lt;<span style="color: #268bd2;">attribute</span> <span style="color: #268bd2;">id</span>=<span style="color: #2aa198;">"</span><span style="color: #2aa198;">givenName</span><span style="color: #2aa198;">"</span>&gt;
        &lt;<span style="color: #268bd2;">display</span>&gt;First name&lt;/<span style="color: #268bd2;">display</span>&gt;
        &lt;<span style="color: #268bd2;">icon</span>&gt;ldap-uid.png&lt;/<span style="color: #268bd2;">icon</span>&gt;
        &lt;<span style="color: #268bd2;">onchange</span>&gt;=autoFill(cn;%givenName% %sn%)&lt;/<span style="color: #268bd2;">onchange</span>&gt;
        &lt;<span style="color: #268bd2;">onchange</span>&gt;=autoFill(uid;%givenName|0-1/l%%sn/l%)&lt;/<span style="color: #268bd2;">onchange</span>&gt;
        &lt;<span style="color: #268bd2;">order</span>&gt;1&lt;/<span style="color: #268bd2;">order</span>&gt;
        &lt;<span style="color: #268bd2;">page</span>&gt;1&lt;/<span style="color: #268bd2;">page</span>&gt;
&lt;/<span style="color: #268bd2;">attribute</span>&gt;
&lt;<span style="color: #268bd2;">attribute</span> <span style="color: #268bd2;">id</span>=<span style="color: #2aa198;">"</span><span style="color: #2aa198;">sn</span><span style="color: #2aa198;">"</span>&gt;
        &lt;<span style="color: #268bd2;">display</span>&gt;Last name&lt;/<span style="color: #268bd2;">display</span>&gt;
        &lt;<span style="color: #268bd2;">onchange</span>&gt;=autoFill(cn;%givenName% %sn%)&lt;/<span style="color: #268bd2;">onchange</span>&gt;
        &lt;<span style="color: #268bd2;">onchange</span>&gt;=autoFill(uid;%givenName|0-1/l%%sn/l%)&lt;/<span style="color: #268bd2;">onchange</span>&gt;
        <span style="color: #93a1a1;">&lt;!--</span><span style="color: #93a1a1;"> &lt;onchange&gt;=autoFill(homeDirectory;/home/users/%uid|0-1/l%/%uid%)&lt;/onchange&gt; </span><span style="color: #93a1a1;">--&gt;</span>
        &lt;<span style="color: #268bd2;">order</span>&gt;2&lt;/<span style="color: #268bd2;">order</span>&gt;
        &lt;<span style="color: #268bd2;">page</span>&gt;1&lt;/<span style="color: #268bd2;">page</span>&gt;
&lt;/<span style="color: #268bd2;">attribute</span>&gt;
&lt;<span style="color: #268bd2;">attribute</span> <span style="color: #268bd2;">id</span>=<span style="color: #2aa198;">"</span><span style="color: #2aa198;">cn</span><span style="color: #2aa198;">"</span>&gt;
        &lt;<span style="color: #268bd2;">display</span>&gt;Common Name&lt;/<span style="color: #268bd2;">display</span>&gt;
        &lt;<span style="color: #268bd2;">order</span>&gt;3&lt;/<span style="color: #268bd2;">order</span>&gt;
        &lt;<span style="color: #268bd2;">page</span>&gt;1&lt;/<span style="color: #268bd2;">page</span>&gt;
&lt;/<span style="color: #268bd2;">attribute</span>&gt;
&lt;<span style="color: #268bd2;">attribute</span> <span style="color: #268bd2;">id</span>=<span style="color: #2aa198;">"</span><span style="color: #2aa198;">uid</span><span style="color: #2aa198;">"</span>&gt;
        &lt;<span style="color: #268bd2;">display</span>&gt;User ID&lt;/<span style="color: #268bd2;">display</span>&gt;
        &lt;<span style="color: #268bd2;">onchange</span>&gt;=autoFill(homeDirectory;/home/users/%uid%)&lt;/<span style="color: #268bd2;">onchange</span>&gt;
        &lt;<span style="color: #268bd2;">order</span>&gt;4&lt;/<span style="color: #268bd2;">order</span>&gt;
        &lt;<span style="color: #268bd2;">page</span>&gt;1&lt;/<span style="color: #268bd2;">page</span>&gt;
        &lt;<span style="color: #268bd2;">spacer</span>&gt;1&lt;/<span style="color: #268bd2;">spacer</span>&gt;
&lt;/<span style="color: #268bd2;">attribute</span>&gt;
&lt;<span style="color: #268bd2;">attribute</span> <span style="color: #268bd2;">id</span>=<span style="color: #2aa198;">"</span><span style="color: #2aa198;">homeDirectory</span><span style="color: #2aa198;">"</span>&gt;
        &lt;<span style="color: #268bd2;">display</span>&gt;Home directory&lt;/<span style="color: #268bd2;">display</span>&gt;
        <span style="color: #93a1a1;">&lt;!--</span><span style="color: #93a1a1;"> &lt;onchange&gt;=autoFill(homeDirectory;/home/users/%gidNumber|0-0/T%/%uid|3-%)&lt;/onchange&gt; </span><span style="color: #93a1a1;">--&gt;</span>
        &lt;<span style="color: #268bd2;">order</span>&gt;8&lt;/<span style="color: #268bd2;">order</span>&gt;
        &lt;<span style="color: #268bd2;">page</span>&gt;1&lt;/<span style="color: #268bd2;">page</span>&gt;
&lt;/<span style="color: #268bd2;">attribute</span>&gt;
&lt;<span style="color: #268bd2;">attribute</span> <span style="color: #268bd2;">id</span>=<span style="color: #2aa198;">"</span><span style="color: #2aa198;">uidNumber</span><span style="color: #2aa198;">"</span>&gt;
        &lt;<span style="color: #268bd2;">display</span>&gt;UID Number&lt;/<span style="color: #268bd2;">display</span>&gt;
        &lt;<span style="color: #268bd2;">icon</span>&gt;terminal.png&lt;/<span style="color: #268bd2;">icon</span>&gt;
        &lt;<span style="color: #268bd2;">order</span>&gt;6&lt;/<span style="color: #268bd2;">order</span>&gt;
        &lt;<span style="color: #268bd2;">page</span>&gt;1&lt;/<span style="color: #268bd2;">page</span>&gt;
        &lt;<span style="color: #268bd2;">readonly</span>&gt;1&lt;/<span style="color: #268bd2;">readonly</span>&gt;
        &lt;<span style="color: #268bd2;">value</span>&gt;=php.GetNextNumber(/;uidNumber)&lt;/<span style="color: #268bd2;">value</span>&gt;
&lt;/<span style="color: #268bd2;">attribute</span>&gt;
&lt;<span style="color: #268bd2;">attribute</span> <span style="color: #268bd2;">id</span>=<span style="color: #2aa198;">"</span><span style="color: #2aa198;">gidNumber</span><span style="color: #2aa198;">"</span>&gt;
        &lt;<span style="color: #268bd2;">display</span>&gt;GID Number&lt;/<span style="color: #268bd2;">display</span>&gt;
        <span style="color: #93a1a1;">&lt;!--</span><span style="color: #93a1a1;"> &lt;onchange&gt;=autoFill(homeDirectory;/home/users/%gidNumber|0-0/T%/%uid|3-%)&lt;/onchange&gt; </span><span style="color: #93a1a1;">--&gt;</span>
        &lt;<span style="color: #268bd2;">order</span>&gt;7&lt;/<span style="color: #268bd2;">order</span>&gt;
        &lt;<span style="color: #268bd2;">page</span>&gt;1&lt;/<span style="color: #268bd2;">page</span>&gt;
        &lt;<span style="color: #268bd2;">value</span>&gt;&lt;![<span style="color: #657b83; font-weight: bold;">CDATA</span>[=php.PickList(/;(&amp;(objectClass=posixGroup));gidNumber;%cn%;;;;cn)]]&gt;&lt;/<span style="color: #268bd2;">value</span>&gt;
&lt;/<span style="color: #268bd2;">attribute</span>&gt;

&lt;<span style="color: #268bd2;">attribute</span> <span style="color: #268bd2;">id</span>=<span style="color: #2aa198;">"</span><span style="color: #2aa198;">shadowMax</span><span style="color: #2aa198;">"</span>&gt;
  &lt;<span style="color: #268bd2;">display</span>&gt;Password Validity (in days)&lt;/<span style="color: #268bd2;">display</span>&gt;
  &lt;<span style="color: #268bd2;">order</span>&gt;11&lt;/<span style="color: #268bd2;">order</span>&gt;
  &lt;<span style="color: #268bd2;">spacer</span>&gt;1&lt;/<span style="color: #268bd2;">spacer</span>&gt;
  &lt;<span style="color: #268bd2;">value</span>&gt;30&lt;/<span style="color: #268bd2;">value</span>&gt;
&lt;/<span style="color: #268bd2;">attribute</span>&gt;

&lt;<span style="color: #268bd2;">attribute</span> <span style="color: #268bd2;">id</span>=<span style="color: #2aa198;">"</span><span style="color: #2aa198;">shadowMin</span><span style="color: #2aa198;">"</span>&gt;
  &lt;<span style="color: #268bd2;">display</span>&gt;Password may be changed (days before)&lt;/<span style="color: #268bd2;">display</span>&gt;
  &lt;<span style="color: #268bd2;">order</span>&gt;12&lt;/<span style="color: #268bd2;">order</span>&gt;
  &lt;<span style="color: #268bd2;">spacer</span>&gt;1&lt;/<span style="color: #268bd2;">spacer</span>&gt;
  &lt;<span style="color: #268bd2;">value</span>&gt;0&lt;/<span style="color: #268bd2;">value</span>&gt;
&lt;/<span style="color: #268bd2;">attribute</span>&gt;

&lt;<span style="color: #268bd2;">attribute</span> <span style="color: #268bd2;">id</span>=<span style="color: #2aa198;">"</span><span style="color: #2aa198;">shadowWarning</span><span style="color: #2aa198;">"</span>&gt;
  &lt;<span style="color: #268bd2;">display</span>&gt;Password Change Warning (days before expiry)&lt;/<span style="color: #268bd2;">display</span>&gt;
  &lt;<span style="color: #268bd2;">order</span>&gt;9&lt;/<span style="color: #268bd2;">order</span>&gt;
  &lt;<span style="color: #268bd2;">spacer</span>&gt;1&lt;/<span style="color: #268bd2;">spacer</span>&gt;
  &lt;<span style="color: #268bd2;">value</span>&gt;5&lt;/<span style="color: #268bd2;">value</span>&gt;
&lt;/<span style="color: #268bd2;">attribute</span>&gt;

&lt;<span style="color: #268bd2;">attribute</span> <span style="color: #268bd2;">id</span>=<span style="color: #2aa198;">"</span><span style="color: #2aa198;">shadowLastChange</span><span style="color: #2aa198;">"</span>&gt;
  &lt;<span style="color: #268bd2;">display</span>&gt;Password Last Changed (in days since 01 Jan 1970)&lt;/<span style="color: #268bd2;">display</span>&gt;
  &lt;<span style="color: #268bd2;">order</span>&gt;10&lt;/<span style="color: #268bd2;">order</span>&gt;
  &lt;<span style="color: #268bd2;">spacer</span>&gt;1&lt;/<span style="color: #268bd2;">spacer</span>&gt;
&lt;/<span style="color: #268bd2;">attribute</span>&gt;

&lt;<span style="color: #268bd2;">attribute</span> <span style="color: #268bd2;">id</span>=<span style="color: #2aa198;">"</span><span style="color: #2aa198;">loginShell</span><span style="color: #2aa198;">"</span>&gt;
        &lt;<span style="color: #268bd2;">display</span>&gt;Login shell&lt;/<span style="color: #268bd2;">display</span>&gt;
        &lt;<span style="color: #268bd2;">order</span>&gt;13&lt;/<span style="color: #268bd2;">order</span>&gt;
        &lt;<span style="color: #268bd2;">page</span>&gt;1&lt;/<span style="color: #268bd2;">page</span>&gt;
        <span style="color: #93a1a1;">&lt;!--</span><span style="color: #93a1a1;"> &lt;value&gt;&lt;![CDATA[=php.PickList(/;(&amp;(objectClass=posixAccount));loginShell;%loginShell%;;;;loginShell)]]&gt;&lt;/value&gt; </span><span style="color: #93a1a1;">--&gt;</span>
        &lt;<span style="color: #268bd2;">type</span>&gt;select&lt;/<span style="color: #268bd2;">type</span>&gt;
        &lt;<span style="color: #268bd2;">value</span> <span style="color: #268bd2;">id</span>=<span style="color: #2aa198;">"</span><span style="color: #2aa198;">/bin/sh</span><span style="color: #2aa198;">"</span>&gt;Bash&lt;/<span style="color: #268bd2;">value</span>&gt;
        &lt;<span style="color: #268bd2;">value</span> <span style="color: #268bd2;">id</span>=<span style="color: #2aa198;">"</span><span style="color: #2aa198;">/bin/csh</span><span style="color: #2aa198;">"</span>&gt;C Shell&lt;/<span style="color: #268bd2;">value</span>&gt;
        &lt;<span style="color: #268bd2;">value</span> <span style="color: #268bd2;">id</span>=<span style="color: #2aa198;">"</span><span style="color: #2aa198;">/bin/tsh</span><span style="color: #2aa198;">"</span>&gt;Turbo C Shell&lt;/<span style="color: #268bd2;">value</span>&gt;
&lt;/<span style="color: #268bd2;">attribute</span>&gt;
&lt;<span style="color: #268bd2;">attribute</span> <span style="color: #268bd2;">id</span>=<span style="color: #2aa198;">"</span><span style="color: #2aa198;">userPassword</span><span style="color: #2aa198;">"</span>&gt;
        &lt;<span style="color: #268bd2;">display</span>&gt;Password&lt;/<span style="color: #268bd2;">display</span>&gt;
        <span style="color: #93a1a1;">&lt;!--</span><span style="color: #93a1a1;"> &lt;helper&gt;</span>
<span style="color: #93a1a1;">                &lt;display&gt;Encryption&lt;/display&gt;</span>
<span style="color: #93a1a1;">                &lt;id&gt;enc&lt;/id&gt;</span>
<span style="color: #93a1a1;">                &lt;value&gt;=php.PasswordEncryptionTypes()&lt;/value&gt;</span>
<span style="color: #93a1a1;">        &lt;/helper&gt; </span><span style="color: #93a1a1;">--&gt;</span>
        &lt;<span style="color: #268bd2;">icon</span>&gt;lock.png&lt;/<span style="color: #268bd2;">icon</span>&gt;
        &lt;<span style="color: #268bd2;">order</span>&gt;5&lt;/<span style="color: #268bd2;">order</span>&gt;
        &lt;<span style="color: #268bd2;">page</span>&gt;1&lt;/<span style="color: #268bd2;">page</span>&gt;
        &lt;<span style="color: #268bd2;">post</span>&gt;=php.PasswordEncrypt(%enc%;%userPassword%)&lt;/<span style="color: #268bd2;">post</span>&gt;
        &lt;<span style="color: #268bd2;">spacer</span>&gt;1&lt;/<span style="color: #268bd2;">spacer</span>&gt;
        &lt;<span style="color: #268bd2;">verify</span>&gt;1&lt;/<span style="color: #268bd2;">verify</span>&gt;
&lt;/<span style="color: #268bd2;">attribute</span>&gt;
&lt;/<span style="color: #268bd2;">attributes</span>&gt;

&lt;/<span style="color: #268bd2;">template</span>&gt;
</pre>
</div>
</div>


<div id="orgparagraph1" class="figure">
<p><img src="./php01.png" alt="php01.png" />
</p>
<p><span class="figure-number">&#1056;&#1080;&#1089;. 1.:</span> Создание пользователя с использованием шаблона phpLDAPadmin</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline24" class="outline-3">
<h3 id="test-client"><a id="orgheadline24"></a><a id="ID-061371a3-a5d6-4fa2-9e15-2d8adef5caf0"></a><span class="section-number-3">4.3</span> Тестирование клиентского подключения</h3>
<div class="outline-text-3" id="text-test-client">
<p>
Для проверки возможности аутентификации будем использовать запись (см. раздел <a href="#new-user-ldap">4.1</a>) <b>username</b>. Протестируем подключение с помощью команды
</p>
<div class="org-src-container">

<pre class="src src-sh">getent passwd username
</pre>
</div>
<p>
которая выводит passwd данные пользователя <b>username</b> из доступных источников, в данном случае задействован сервер LDAP
</p>
<div class="org-src-container">

<pre class="src src-conf-colon"><span style="color: #268bd2;">username</span>:x:1050:1030:User Name:/home/webminder:/bin/bash
</pre>
</div>

<p>
Убедимся, что механизм <b>sudoers</b> задействован. Вывод команды
</p>
<div class="org-src-container">

<pre class="src src-sh">sshpass -p p@ssw0rd ssh -t username@$(<span style="color: #6c71c4; font-weight: bold;">ip</span>) sudo ls /root
</pre>
</div>
<p>
демонстрирует, что пользователь <b>username</b> успешно прочитал содержимое каталога <b>root</b> с помощью <b>sudo</b>
</p>
<div class="org-src-container">

<pre class="src src-raw">Dockerfile5  Dockerfile6  run5.sh  run6.sh
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline25" class="outline-3">
<h3 id="standard-commands"><a id="orgheadline25"></a><a id="ID-84d40fcf-c285-40e6-9f13-11685889a085"></a><span class="section-number-3">4.4</span> Стандартные команды администрирования пользователей в случае использования LDAP</h3>
<div class="outline-text-3" id="text-standard-commands">
<blockquote>
<p>
Предложить LDAP-варианты для команд <b>passwd</b>, <b>useradd</b>, <b>usermod</b>, <b>finger</b>, <b>chsh</b>, <b>chfn</b> и функциональности <b>.forward</b>.
</p>
</blockquote>

<div class="org-src-container">
<label class="org-src-name">Изменение пароля пользователя с помощью утилиты <b>ldappasswd</b></label>
<pre class="src src-sh">ldappasswd -h $(<span style="color: #6c71c4; font-weight: bold;">ip</span>) -x -D <span style="color: #2aa198;">"uid=username,ou=people,dc=mercury,dc=febras,dc=net"</span> -w p@ssw0rd -s 1
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name">Изменение значения <b>loginShell</b> с помощью утилиты <b>ldapmodify</b></label>
<pre class="src src-sh" id="orgsrcblock6"><span style="color: #93a1a1;">#</span><span style="color: #93a1a1;">!/bin/</span><span style="color: #859900; font-weight: bold;">bash</span>

ldapmodify -h $<span style="color: #268bd2;">1</span> -x -D <span style="color: #2aa198;">"uid=username,ou=people,dc=mercury,dc=febras,dc=net"</span> -w 1 &lt;&lt;EOF
<span style="color: #b58900; font-weight: bold;">dn: uid=username,ou=people,dc=mercury,dc=febras,dc=net</span>
<span style="color: #b58900; font-weight: bold;">changetype: modify</span>
<span style="color: #b58900; font-weight: bold;">replace: loginShell</span>
<span style="color: #b58900; font-weight: bold;">loginShell: /bin/sh</span>
<span style="color: #b58900; font-weight: bold;">-</span>
<span style="color: #b58900; font-weight: bold;">EOF</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline26" class="outline-3">
<h3 id="add-users"><a id="orgheadline26"></a><a id="ID-3c998117-af2e-4965-94c7-3ebfb31d7691"></a><span class="section-number-3">4.5</span> Миграция пользователей и групп</h3>
<div class="outline-text-3" id="text-add-users">
<a onclick="toggleDiv2('myContent-passwd',$(this));" class="fa fa-caret-right">passwd.ldif</a>

<div id="myContent-passwd" style="display:none">
<div class="org-src-container">

<pre class="src src-ldif"><span style="color: #859900; font-weight: bold;">dn</span>: <span style="color: #268bd2;">uid=root,ou=People,dc=mercury,dc=febras,dc=net</span>
uid: root
cn: root
objectClass: account
objectClass: posixAccount
objectClass: top
objectClass: shadowAccount
userPassword: {crypt}$1$z9Z3EWQ0$YOqB8odzPaJP/TDgpsDUo/
shadowLastChange: 17128
shadowMin: 0
shadowMax: 99999
shadowWarning: 7
loginShell: /bin/bash
uidNumber: 0
gidNumber: 0
homeDirectory: /root
gecos: root

<span style="color: #859900; font-weight: bold;">dn</span>: <span style="color: #268bd2;">uid=bin,ou=People,dc=mercury,dc=febras,dc=net</span>
uid: bin
cn: bin
objectClass: account
objectClass: posixAccount
objectClass: top
objectClass: shadowAccount
userPassword: {crypt}*
shadowLastChange: 17128
shadowMin: 0
shadowMax: 99999
shadowWarning: 7
loginShell: /sbin/nologin
uidNumber: 1
gidNumber: 1
homeDirectory: /bin
gecos: bin

<span style="color: #859900; font-weight: bold;">dn</span>: <span style="color: #268bd2;">uid=daemon,ou=People,dc=mercury,dc=febras,dc=net</span>
uid: daemon
cn: daemon
objectClass: account
objectClass: posixAccount
objectClass: top
objectClass: shadowAccount
userPassword: {crypt}*
shadowLastChange: 17128
shadowMin: 0
shadowMax: 99999
shadowWarning: 7
loginShell: /sbin/nologin
uidNumber: 2
gidNumber: 2
homeDirectory: /sbin
gecos: daemon

<span style="color: #859900; font-weight: bold;">dn</span>: <span style="color: #268bd2;">uid=adm,ou=People,dc=mercury,dc=febras,dc=net</span>
uid: adm
cn: adm
objectClass: account
objectClass: posixAccount
objectClass: top
objectClass: shadowAccount
userPassword: {crypt}*
shadowLastChange: 17128
shadowMin: 0
shadowMax: 99999
shadowWarning: 7
loginShell: /sbin/nologin
uidNumber: 3
gidNumber: 4
homeDirectory: /var/adm
gecos: adm

<span style="color: #859900; font-weight: bold;">dn</span>: <span style="color: #268bd2;">uid=lp,ou=People,dc=mercury,dc=febras,dc=net</span>
uid: lp
cn: lp
objectClass: account
objectClass: posixAccount
objectClass: top
objectClass: shadowAccount
userPassword: {crypt}*
shadowLastChange: 17128
shadowMin: 0
shadowMax: 99999
shadowWarning: 7
loginShell: /sbin/nologin
uidNumber: 4
gidNumber: 7
homeDirectory: /var/spool/lpd
gecos: lp

<span style="color: #859900; font-weight: bold;">dn</span>: <span style="color: #268bd2;">uid=sync,ou=People,dc=mercury,dc=febras,dc=net</span>
uid: sync
cn: sync
objectClass: account
objectClass: posixAccount
objectClass: top
objectClass: shadowAccount
userPassword: {crypt}*
shadowLastChange: 17128
shadowMin: 0
shadowMax: 99999
shadowWarning: 7
loginShell: /bin/sync
uidNumber: 5
gidNumber: 0
homeDirectory: /sbin
gecos: sync

<span style="color: #859900; font-weight: bold;">dn</span>: <span style="color: #268bd2;">uid=shutdown,ou=People,dc=mercury,dc=febras,dc=net</span>
uid: shutdown
cn: shutdown
objectClass: account
objectClass: posixAccount
objectClass: top
objectClass: shadowAccount
userPassword: {crypt}*
shadowLastChange: 17128
shadowMin: 0
shadowMax: 99999
shadowWarning: 7
loginShell: /sbin/shutdown
uidNumber: 6
gidNumber: 0
homeDirectory: /sbin
gecos: shutdown

<span style="color: #859900; font-weight: bold;">dn</span>: <span style="color: #268bd2;">uid=halt,ou=People,dc=mercury,dc=febras,dc=net</span>
uid: halt
cn: halt
objectClass: account
objectClass: posixAccount
objectClass: top
objectClass: shadowAccount
userPassword: {crypt}*
shadowLastChange: 17128
shadowMin: 0
shadowMax: 99999
shadowWarning: 7
loginShell: /sbin/halt
uidNumber: 7
gidNumber: 0
homeDirectory: /sbin
gecos: halt

<span style="color: #859900; font-weight: bold;">dn</span>: <span style="color: #268bd2;">uid=mail,ou=People,dc=mercury,dc=febras,dc=net</span>
uid: mail
cn: mail
objectClass: account
objectClass: posixAccount
objectClass: top
objectClass: shadowAccount
userPassword: {crypt}*
shadowLastChange: 17128
shadowMin: 0
shadowMax: 99999
shadowWarning: 7
loginShell: /sbin/nologin
uidNumber: 8
gidNumber: 12
homeDirectory: /var/spool/mail
gecos: mail

<span style="color: #859900; font-weight: bold;">dn</span>: <span style="color: #268bd2;">uid=news,ou=People,dc=mercury,dc=febras,dc=net</span>
uid: news
cn: news
objectClass: account
objectClass: posixAccount
objectClass: top
objectClass: shadowAccount
userPassword: {crypt}*
shadowLastChange: 17128
shadowMin: 0
shadowMax: 99999
shadowWarning: 7
uidNumber: 9
gidNumber: 13
homeDirectory: /etc/news
gecos: news

<span style="color: #859900; font-weight: bold;">dn</span>: <span style="color: #268bd2;">uid=uucp,ou=People,dc=mercury,dc=febras,dc=net</span>
uid: uucp
cn: uucp
objectClass: account
objectClass: posixAccount
objectClass: top
objectClass: shadowAccount
userPassword: {crypt}*
shadowLastChange: 17128
shadowMin: 0
shadowMax: 99999
shadowWarning: 7
loginShell: /sbin/nologin
uidNumber: 10
gidNumber: 14
homeDirectory: /var/spool/uucp
gecos: uucp

<span style="color: #859900; font-weight: bold;">dn</span>: <span style="color: #268bd2;">uid=operator,ou=People,dc=mercury,dc=febras,dc=net</span>
uid: operator
cn: operator
objectClass: account
objectClass: posixAccount
objectClass: top
objectClass: shadowAccount
userPassword: {crypt}*
shadowLastChange: 17128
shadowMin: 0
shadowMax: 99999
shadowWarning: 7
loginShell: /sbin/nologin
uidNumber: 11
gidNumber: 0
homeDirectory: /root
gecos: operator

<span style="color: #859900; font-weight: bold;">dn</span>: <span style="color: #268bd2;">uid=games,ou=People,dc=mercury,dc=febras,dc=net</span>
uid: games
cn: games
objectClass: account
objectClass: posixAccount
objectClass: top
objectClass: shadowAccount
userPassword: {crypt}*
shadowLastChange: 17128
shadowMin: 0
shadowMax: 99999
shadowWarning: 7
loginShell: /sbin/nologin
uidNumber: 12
gidNumber: 100
homeDirectory: /usr/games
gecos: games

<span style="color: #859900; font-weight: bold;">dn</span>: <span style="color: #268bd2;">uid=gopher,ou=People,dc=mercury,dc=febras,dc=net</span>
uid: gopher
cn: gopher
objectClass: account
objectClass: posixAccount
objectClass: top
objectClass: shadowAccount
userPassword: {crypt}*
shadowLastChange: 17128
shadowMin: 0
shadowMax: 99999
shadowWarning: 7
loginShell: /sbin/nologin
uidNumber: 13
gidNumber: 30
homeDirectory: /var/gopher
gecos: gopher

<span style="color: #859900; font-weight: bold;">dn</span>: <span style="color: #268bd2;">uid=ftp,ou=People,dc=mercury,dc=febras,dc=net</span>
uid: ftp
cn: FTP User
objectClass: account
objectClass: posixAccount
objectClass: top
objectClass: shadowAccount
userPassword: {crypt}*
shadowLastChange: 17128
shadowMin: 0
shadowMax: 99999
shadowWarning: 7
loginShell: /sbin/nologin
uidNumber: 14
gidNumber: 50
homeDirectory: /var/ftp
gecos: FTP User

<span style="color: #859900; font-weight: bold;">dn</span>: <span style="color: #268bd2;">uid=nobody,ou=People,dc=mercury,dc=febras,dc=net</span>
uid: nobody
cn: Nobody
objectClass: account
objectClass: posixAccount
objectClass: top
objectClass: shadowAccount
userPassword: {crypt}*
shadowLastChange: 17128
shadowMin: 0
shadowMax: 99999
shadowWarning: 7
loginShell: /sbin/nologin
uidNumber: 99
gidNumber: 99
homeDirectory: /
gecos: Nobody

<span style="color: #859900; font-weight: bold;">dn</span>: <span style="color: #268bd2;">uid=vcsa,ou=People,dc=mercury,dc=febras,dc=net</span>
uid: vcsa
cn: virtual console memory owner
objectClass: account
objectClass: posixAccount
objectClass: top
objectClass: shadowAccount
userPassword: {crypt}!!
shadowLastChange: 17128
shadowMin: 0
shadowMax: 99999
shadowWarning: 7
loginShell: /sbin/nologin
uidNumber: 69
gidNumber: 69
homeDirectory: /dev
gecos: virtual console memory owner

<span style="color: #859900; font-weight: bold;">dn</span>: <span style="color: #268bd2;">uid=nscd,ou=People,dc=mercury,dc=febras,dc=net</span>
uid: nscd
cn: NSCD Daemon
objectClass: account
objectClass: posixAccount
objectClass: top
objectClass: shadowAccount
userPassword: {crypt}!!
shadowLastChange: 17128
shadowMin: 0
shadowMax: 99999
shadowWarning: 7
loginShell: /sbin/nologin
uidNumber: 28
gidNumber: 28
homeDirectory: /
gecos: NSCD Daemon

<span style="color: #859900; font-weight: bold;">dn</span>: <span style="color: #268bd2;">uid=sshd,ou=People,dc=mercury,dc=febras,dc=net</span>
uid: sshd
cn: Privilege-separated SSH
objectClass: account
objectClass: posixAccount
objectClass: top
objectClass: shadowAccount
userPassword: {crypt}!!
shadowLastChange: 17128
shadowMin: 0
shadowMax: 99999
shadowWarning: 7
loginShell: /sbin/nologin
uidNumber: 74
gidNumber: 74
homeDirectory: /var/empty/sshd
gecos: Privilege-separated SSH

<span style="color: #859900; font-weight: bold;">dn</span>: <span style="color: #268bd2;">uid=ldap,ou=People,dc=mercury,dc=febras,dc=net</span>
uid: ldap
cn: LDAP User
objectClass: account
objectClass: posixAccount
objectClass: top
objectClass: shadowAccount
userPassword: {crypt}!!
shadowLastChange: 17128
shadowMin: 0
shadowMax: 99999
shadowWarning: 7
loginShell: /bin/false
uidNumber: 55
gidNumber: 55
homeDirectory: /var/lib/ldap
gecos: LDAP User
</pre>
</div>
</div>

<br/><a onclick="toggleDiv2('myContent-group',$(this));" class="fa fa-caret-right">group.ldif</a>

<div id="myContent-group" style="display:none">
<div class="org-src-container">

<pre class="src src-ldif"><span style="color: #859900; font-weight: bold;">dn</span>: <span style="color: #268bd2;">cn=root,ou=Group,dc=mercury,dc=febras,dc=net</span>
objectClass: posixGroup
objectClass: top
cn: root
userPassword: {crypt}x
gidNumber: 0

<span style="color: #859900; font-weight: bold;">dn</span>: <span style="color: #268bd2;">cn=bin,ou=Group,dc=mercury,dc=febras,dc=net</span>
objectClass: posixGroup
objectClass: top
cn: bin
userPassword: {crypt}x
gidNumber: 1
memberUid: daemon
memberUid: root

<span style="color: #859900; font-weight: bold;">dn</span>: <span style="color: #268bd2;">cn=daemon,ou=Group,dc=mercury,dc=febras,dc=net</span>
objectClass: posixGroup
objectClass: top
cn: daemon
userPassword: {crypt}x
gidNumber: 2
memberUid: bin
memberUid: root

<span style="color: #859900; font-weight: bold;">dn</span>: <span style="color: #268bd2;">cn=sys,ou=Group,dc=mercury,dc=febras,dc=net</span>
objectClass: posixGroup
objectClass: top
cn: sys
userPassword: {crypt}x
gidNumber: 3
memberUid: adm
memberUid: bin
memberUid: root

<span style="color: #859900; font-weight: bold;">dn</span>: <span style="color: #268bd2;">cn=adm,ou=Group,dc=mercury,dc=febras,dc=net</span>
objectClass: posixGroup
objectClass: top
cn: adm
userPassword: {crypt}x
gidNumber: 4
memberUid: daemon
memberUid: root

<span style="color: #859900; font-weight: bold;">dn</span>: <span style="color: #268bd2;">cn=tty,ou=Group,dc=mercury,dc=febras,dc=net</span>
objectClass: posixGroup
objectClass: top
cn: tty
userPassword: {crypt}x
gidNumber: 5

<span style="color: #859900; font-weight: bold;">dn</span>: <span style="color: #268bd2;">cn=disk,ou=Group,dc=mercury,dc=febras,dc=net</span>
objectClass: posixGroup
objectClass: top
cn: disk
userPassword: {crypt}x
gidNumber: 6
memberUid: root

<span style="color: #859900; font-weight: bold;">dn</span>: <span style="color: #268bd2;">cn=lp,ou=Group,dc=mercury,dc=febras,dc=net</span>
objectClass: posixGroup
objectClass: top
cn: lp
userPassword: {crypt}x
gidNumber: 7
memberUid: daemon

<span style="color: #859900; font-weight: bold;">dn</span>: <span style="color: #268bd2;">cn=mem,ou=Group,dc=mercury,dc=febras,dc=net</span>
objectClass: posixGroup
objectClass: top
cn: mem
userPassword: {crypt}x
gidNumber: 8

<span style="color: #859900; font-weight: bold;">dn</span>: <span style="color: #268bd2;">cn=kmem,ou=Group,dc=mercury,dc=febras,dc=net</span>
objectClass: posixGroup
objectClass: top
cn: kmem
userPassword: {crypt}x
gidNumber: 9

<span style="color: #859900; font-weight: bold;">dn</span>: <span style="color: #268bd2;">cn=wheel,ou=Group,dc=mercury,dc=febras,dc=net</span>
objectClass: posixGroup
objectClass: top
cn: wheel
userPassword: {crypt}x
gidNumber: 10
memberUid: root

<span style="color: #859900; font-weight: bold;">dn</span>: <span style="color: #268bd2;">cn=mail,ou=Group,dc=mercury,dc=febras,dc=net</span>
objectClass: posixGroup
objectClass: top
cn: mail
userPassword: {crypt}x
gidNumber: 12

<span style="color: #859900; font-weight: bold;">dn</span>: <span style="color: #268bd2;">cn=news,ou=Group,dc=mercury,dc=febras,dc=net</span>
objectClass: posixGroup
objectClass: top
cn: news
userPassword: {crypt}x
gidNumber: 13

<span style="color: #859900; font-weight: bold;">dn</span>: <span style="color: #268bd2;">cn=uucp,ou=Group,dc=mercury,dc=febras,dc=net</span>
objectClass: posixGroup
objectClass: top
cn: uucp
userPassword: {crypt}x
gidNumber: 14

<span style="color: #859900; font-weight: bold;">dn</span>: <span style="color: #268bd2;">cn=man,ou=Group,dc=mercury,dc=febras,dc=net</span>
objectClass: posixGroup
objectClass: top
cn: man
userPassword: {crypt}x
gidNumber: 15

<span style="color: #859900; font-weight: bold;">dn</span>: <span style="color: #268bd2;">cn=games,ou=Group,dc=mercury,dc=febras,dc=net</span>
objectClass: posixGroup
objectClass: top
cn: games
userPassword: {crypt}x
gidNumber: 20

<span style="color: #859900; font-weight: bold;">dn</span>: <span style="color: #268bd2;">cn=gopher,ou=Group,dc=mercury,dc=febras,dc=net</span>
objectClass: posixGroup
objectClass: top
cn: gopher
userPassword: {crypt}x
gidNumber: 30

<span style="color: #859900; font-weight: bold;">dn</span>: <span style="color: #268bd2;">cn=dip,ou=Group,dc=mercury,dc=febras,dc=net</span>
objectClass: posixGroup
objectClass: top
cn: dip
userPassword: {crypt}x
gidNumber: 40

<span style="color: #859900; font-weight: bold;">dn</span>: <span style="color: #268bd2;">cn=ftp,ou=Group,dc=mercury,dc=febras,dc=net</span>
objectClass: posixGroup
objectClass: top
cn: ftp
userPassword: {crypt}x
gidNumber: 50

<span style="color: #859900; font-weight: bold;">dn</span>: <span style="color: #268bd2;">cn=lock,ou=Group,dc=mercury,dc=febras,dc=net</span>
objectClass: posixGroup
objectClass: top
cn: lock
userPassword: {crypt}x
gidNumber: 54

<span style="color: #859900; font-weight: bold;">dn</span>: <span style="color: #268bd2;">cn=nobody,ou=Group,dc=mercury,dc=febras,dc=net</span>
objectClass: posixGroup
objectClass: top
cn: nobody
userPassword: {crypt}x
gidNumber: 99

<span style="color: #859900; font-weight: bold;">dn</span>: <span style="color: #268bd2;">cn=users,ou=Group,dc=mercury,dc=febras,dc=net</span>
objectClass: posixGroup
objectClass: top
cn: users
userPassword: {crypt}x
gidNumber: 100

<span style="color: #859900; font-weight: bold;">dn</span>: <span style="color: #268bd2;">cn=floppy,ou=Group,dc=mercury,dc=febras,dc=net</span>
objectClass: posixGroup
objectClass: top
cn: floppy
userPassword: {crypt}x
gidNumber: 19

<span style="color: #859900; font-weight: bold;">dn</span>: <span style="color: #268bd2;">cn=vcsa,ou=Group,dc=mercury,dc=febras,dc=net</span>
objectClass: posixGroup
objectClass: top
cn: vcsa
userPassword: {crypt}x
gidNumber: 69

<span style="color: #859900; font-weight: bold;">dn</span>: <span style="color: #268bd2;">cn=audio,ou=Group,dc=mercury,dc=febras,dc=net</span>
objectClass: posixGroup
objectClass: top
cn: audio
userPassword: {crypt}x
gidNumber: 63

<span style="color: #859900; font-weight: bold;">dn</span>: <span style="color: #268bd2;">cn=utmp,ou=Group,dc=mercury,dc=febras,dc=net</span>
objectClass: posixGroup
objectClass: top
cn: utmp
userPassword: {crypt}x
gidNumber: 22

<span style="color: #859900; font-weight: bold;">dn</span>: <span style="color: #268bd2;">cn=nscd,ou=Group,dc=mercury,dc=febras,dc=net</span>
objectClass: posixGroup
objectClass: top
cn: nscd
userPassword: {crypt}x
gidNumber: 28

<span style="color: #859900; font-weight: bold;">dn</span>: <span style="color: #268bd2;">cn=sshd,ou=Group,dc=mercury,dc=febras,dc=net</span>
objectClass: posixGroup
objectClass: top
cn: sshd
userPassword: {crypt}x
gidNumber: 74

<span style="color: #859900; font-weight: bold;">dn</span>: <span style="color: #268bd2;">cn=ldap,ou=Group,dc=mercury,dc=febras,dc=net</span>
objectClass: posixGroup
objectClass: top
cn: ldap
userPassword: {crypt}x
gidNumber: 55
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-orgheadline28" class="outline-2">
<h2 id="cluster"><a id="orgheadline28"></a><a id="ID-db5bc4cf-74c3-40e0-b8b3-d57f3f32e338"></a><span class="section-number-2">5</span> Перевести аутентификацию пользователей кластера на использование LDAP</h2>
<div class="outline-text-2" id="text-cluster">
</div>
</div>
<div id="footnotes">
<h2 class="footnotes">&#1057;&#1085;&#1086;&#1089;&#1082;&#1080;: </h2>
<div id="text-footnotes">

<div class="footdef"><sup><a id="fn.1" class="footnum" href="#fnr.1">1</a></sup> <div class="footpara"><a href="http://pro-ldap.ru/tr/admin24/quickstart.html">http://pro-ldap.ru/tr/admin24/quickstart.html</a></div></div>

<div class="footdef"><sup><a id="fn.2" class="footnum" href="#fnr.2">2</a></sup> <div class="footpara"><a href="http://pro-ldap.ru/tr/admin24/slapdconf2.html#Converting%20old%20style%20slapd.conf%20file%20to%20cn=config%20format">http://pro-ldap.ru/tr/admin24/slapdconf2.html#Converting%20old%20style%20slapd.conf%20file%20to%20cn=config%20format</a></div></div>

<div class="footdef"><sup><a id="fn.3" class="footnum" href="#fnr.3">3</a></sup> <div class="footpara"><a href="https://github.com/boykov/cc-ldap-centos/blob/master/ldap-server/2.5-schema-ldif.sh">https://github.com/boykov/cc-ldap-centos/blob/master/ldap-server/2.5-schema-ldif.sh</a></div></div>


</div>
</div></div>
</body>
</html>
